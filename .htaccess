# تفعيل معالجة ملفات PHP - يجب أن يكون في البداية
AddType application/x-httpd-php .php

# إعدادات PHP
<IfModule mod_php.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_value error_log logs/php_errors.log
</IfModule>

# التأكد من معالجة ملفات PHP (لجميع أنواع الخوادم)
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# إعادة كتابة URL لملفات PHP
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # السماح بالوصول المباشر لملفات PHP الموجودة
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_FILENAME} \.php$
    RewriteRule ^(.*)$ $1 [L]
    
    # منع الوصول المباشر للملفات الحساسة
    <FilesMatch "\.(htaccess|htpasswd|ini|log|sql|bak)$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>
</IfModule>

# إعدادات CORS
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin"
</IfModule>

# منع عرض قائمة الملفات
Options -Indexes

# ضغط الملفات
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Cache Control للملفات الثابتة
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
</IfModule>

# منع Cache لملفات PHP
<FilesMatch "\.php$">
    <IfModule mod_headers.c>
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </IfModule>
</FilesMatch>
