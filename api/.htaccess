# إعدادات خاصة بمجلد API

# تفعيل PHP - ضروري لـ LiteSpeed و Apache
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php

# ملاحظة: إعدادات CORS والأمان يتم ضبطها من config.php ديناميكياً
# هذا يمنع التعارضات ويضمن عمل credentials بشكل صحيح

# معالجة طلبات OPTIONS (preflight) - نسخة احتياطية
# config.php يتعامل معها أيضاً، لكن نتركها للاستضافات التي قد تحتاجها
RewriteEngine On
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ - [R=200,L]

# السماح بجميع طرق HTTP (GET, POST, PUT, DELETE, OPTIONS, PATCH)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} ^(GET|POST|PUT|DELETE|OPTIONS|PATCH)$
    RewriteRule ^(.*)$ - [L]
</IfModule>

# إعادة توجيه طلبات PUT/DELETE إلى POST للاستضافات المجانية
RewriteCond %{REQUEST_METHOD} ^(PUT|DELETE)$
RewriteRule ^(.*)$ $1 [L]

# السماح بملفات API العامة
# استخدام صيغة متوافقة مع Apache 2.2 و 2.4+ و LiteSpeed
<IfModule mod_authz_core.c>
    # Apache 2.4+ و LiteSpeed
    <FilesMatch "\.(php)$">
        Require all granted
    </FilesMatch>
    <DirectoryMatch ".*">
        Require all granted
    </DirectoryMatch>
</IfModule>

<IfModule !mod_authz_core.c>
    # Apache 2.2 (fallback للخوادم القديمة)
    <FilesMatch "\.(php)$">
        Order allow,deny
        Allow from all
    </FilesMatch>
    <DirectoryMatch ".*">
        Order allow,deny
        Allow from all
    </DirectoryMatch>
</IfModule>

# قواعد خاصة لـ LiteSpeed Web Server
<IfModule LiteSpeed>
    # السماح بتنفيذ PHP
    <FilesMatch "\.(php)$">
        SetHandler lsapi
    </FilesMatch>
    # السماح بجميع الطلبات
    Options +ExecCGI
    Options +FollowSymLinks
</IfModule>

# منع عرض محتويات المجلد (الأمان)
Options -Indexes
