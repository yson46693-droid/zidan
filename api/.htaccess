# ============================================
# إعدادات مجلد API - نسخة محسّنة لجميع الملفات
# ============================================

# تفعيل PHP
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php

# السماح بجميع الطلبات في هذا المجلد (يجب أن يكون أولاً)
<IfModule mod_authz_core.c>
    Require all granted
</IfModule>
<IfModule !mod_authz_core.c>
    Order allow,deny
    Allow from all
</IfModule>

# قاعدة عامة: السماح بجميع ملفات PHP في هذا المجلد
<FilesMatch "\.php$">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</FilesMatch>

# قاعدة خاصة لـ auth.php - السماح بجميع الطلبات
<Files "auth.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    Options +FollowSymLinks
</Files>

# السماح بتنفيذ PHP في جميع الملفات
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# منع عرض محتويات المجلد (الأمان)
Options -Indexes

# السماح بـ FollowSymLinks
Options +FollowSymLinks

# السماح بجميع طرق HTTP (GET, POST, PUT, DELETE, OPTIONS, PATCH)
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # السماح بجميع طرق HTTP - يجب أن يكون قبل أي قواعد أخرى
    RewriteCond %{REQUEST_METHOD} ^(GET|POST|PUT|DELETE|OPTIONS|PATCH|HEAD)$
    RewriteRule ^ - [L]
    
    # معالجة طلبات OPTIONS (preflight)
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^ - [R=200,L]
</IfModule>

# ✅ CORS Headers - محسّنة لـ Shared Hosting
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin, X-HTTP-Method-Override"
    Header set Access-Control-Allow-Credentials "true"
    Header set Access-Control-Max-Age "3600"
</IfModule>

# ✅ قواعد خاصة لـ LiteSpeed Web Server
<IfModule LiteSpeed>
    <FilesMatch "\.php$">
        SetHandler lsapi
        Require all granted
    </FilesMatch>
    Options +FollowSymLinks
</IfModule>