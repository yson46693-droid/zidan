# ุฅุนุฏุงุฏุงุช ุฎุงุตุฉ ุจูุฌูุฏ API

# ุชูุนูู PHP - ุถุฑูุฑู ูู LiteSpeed ู Apache
AddType application/x-httpd-php .php
AddHandler application/x-httpd-php .php

# ููุงุญุธุฉ: ุฅุนุฏุงุฏุงุช CORS ูุงูุฃูุงู ูุชู ุถุจุทูุง ูู config.php ุฏููุงููููุงู
# ูุฐุง ูููุน ุงูุชุนุงุฑุถุงุช ููุถูู ุนูู credentials ุจุดูู ุตุญูุญ

# ============================================
# ๐ ุฅุตูุงุญ ูุดููุฉ 403 Forbidden ูู auth.php
# ============================================

# ุชุนุทูู mod_security ุจุดูู ูุงูู ูู auth.php
<IfModule mod_security.c>
    <LocationMatch "^/.*api/auth\.php$">
        SecRuleEngine Off
    </LocationMatch>
    <FilesMatch "^.*api/auth\.php$">
        SecRuleEngine Off
    </FilesMatch>
</IfModule>

# ูุงุนุฏุฉ ุฎุงุตุฉ ูู auth.php - ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช
<Files "auth.php">
    # Apache 2.4+ ู LiteSpeed
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    # Apache 2.2 (fallback)
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    # ุงูุณูุงุญ ุจุฌููุน ุทุฑู HTTP
    Options +ExecCGI +FollowSymLinks +Indexes
    # ูุงุนุฏุฉ ุฎุงุตุฉ ูู LiteSpeed
    <IfModule LiteSpeed>
        SetHandler lsapi
        Require all granted
        Options +ExecCGI +FollowSymLinks
    </IfModule>
</Files>

# ูุนุงูุฌุฉ ุทูุจุงุช OPTIONS (preflight) - ูุณุฎุฉ ุงุญุชูุงุทูุฉ
# config.php ูุชุนุงูู ูุนูุง ุฃูุถุงูุ ููู ูุชุฑููุง ููุงุณุชุถุงูุงุช ุงูุชู ูุฏ ุชุญุชุงุฌูุง
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # ุงูุณูุงุญ ุจุฌููุน ุทุฑู HTTP (GET, POST, PUT, DELETE, OPTIONS, PATCH)
    RewriteCond %{REQUEST_METHOD} ^(GET|POST|PUT|DELETE|OPTIONS|PATCH)$
    RewriteRule ^(.*)$ - [L]
    
    # ูุนุงูุฌุฉ ุทูุจุงุช OPTIONS ุจุดูู ุฎุงุต
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ - [R=200,L]
    
    # ูุงุนุฏุฉ ุฎุงุตุฉ ูู auth.php - ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช
    RewriteCond %{REQUEST_URI} auth\.php$
    RewriteRule ^(.*)$ - [L,E=no-gzip:1]
</IfModule>

# ุฅุนุงุฏุฉ ุชูุฌูู ุทูุจุงุช PUT/DELETE ุฅูู POST ููุงุณุชุถุงูุงุช ุงููุฌุงููุฉ
<IfModule mod_rewrite.c>
    RewriteCond %{REQUEST_METHOD} ^(PUT|DELETE)$
    RewriteRule ^(.*)$ $1 [L]
</IfModule>

# ุงูุณูุงุญ ุจูููุงุช API ุงูุนุงูุฉ
# ุงุณุชุฎุฏุงู ุตูุบุฉ ูุชูุงููุฉ ูุน Apache 2.2 ู 2.4+ ู LiteSpeed
<IfModule mod_authz_core.c>
    # Apache 2.4+ ู LiteSpeed
    <FilesMatch "\.(php)$">
        Require all granted
    </FilesMatch>
    <Files "auth.php">
        Require all granted
    </Files>
    <DirectoryMatch ".*">
        Require all granted
    </DirectoryMatch>
    # ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช ูู ูุฐุง ุงููุฌูุฏ
    <Directory ".">
        Require all granted
        Options +ExecCGI +FollowSymLinks
    </Directory>
</IfModule>

<IfModule !mod_authz_core.c>
    # Apache 2.2 (fallback ููุฎูุงุฏู ุงููุฏููุฉ)
    <FilesMatch "\.(php)$">
        Order allow,deny
        Allow from all
    </FilesMatch>
    <Files "auth.php">
        Order allow,deny
        Allow from all
    </Files>
    <DirectoryMatch ".*">
        Order allow,deny
        Allow from all
    </DirectoryMatch>
    # ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช ูู ูุฐุง ุงููุฌูุฏ
    <Directory ".">
        Order allow,deny
        Allow from all
        Options +ExecCGI +FollowSymLinks
    </Directory>
</IfModule>

# ููุงุนุฏ ุฎุงุตุฉ ูู LiteSpeed Web Server
<IfModule LiteSpeed>
    # ุงูุณูุงุญ ุจุชูููุฐ PHP
    <FilesMatch "\.(php)$">
        SetHandler lsapi
        Require all granted
    </FilesMatch>
    <Files "auth.php">
        SetHandler lsapi
        Require all granted
    </Files>
    # ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช
    Options +ExecCGI
    Options +FollowSymLinks
    # ุงูุณูุงุญ ุจุฌููุน ุงูุทูุจุงุช ูู ูุฐุง ุงููุฌูุฏ
    <Directory ".">
        Require all granted
        Options +ExecCGI +FollowSymLinks
    </Directory>
    # ูุงุนุฏุฉ ุฎุงุตุฉ ูููุน 403 ูู LiteSpeed
    # ุงูุณูุงุญ ุจุฌููุน ุทุฑู HTTP ุจุดูู ุตุฑูุญ
    <IfModule mod_rewrite.c>
        RewriteEngine On
        # ุงูุณูุงุญ ุจุทูุจุงุช POST ุฅูู ุฌููุน ูููุงุช PHP
        RewriteCond %{REQUEST_METHOD} POST
        RewriteCond %{REQUEST_URI} \.php$
        RewriteRule ^(.*)$ - [L,E=no-gzip:1]
    </IfModule>
</IfModule>

# ููุน ุนุฑุถ ูุญุชููุงุช ุงููุฌูุฏ (ุงูุฃูุงู)
Options -Indexes

# ุงูุณูุงุญ ุจุฌููุน ุทุฑู HTTP ุจุดูู ุตุฑูุญ - ุญู ูุดููุฉ 403
<IfModule mod_headers.c>
    # ุฅุฒุงูุฉ ุฃู ูููุฏ ุนูู ุทุฑู HTTP
    Header unset X-Requested-With
</IfModule>

# ุงูุณูุงุญ ุจุชูููุฐ PHP ูู ุฌููุน ุงููููุงุช
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# ููุงุนุฏ ุฅุถุงููุฉ ูููุน 403 Forbidden
# ุงูุณูุงุญ ุจุทูุจุงุช POST ูุน Content-Type: application/json
<IfModule mod_headers.c>
    # ุงูุณูุงุญ ุจุฌููุน ุฃููุงุน ุงููุญุชูู ูู ุงูุทูุจุงุช
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin, X-HTTP-Method-Override"
</IfModule>

# ูุญุงููุฉ ุชุนุทูู ููุงุนุฏ mod_security ููุทูุจุงุช ุฅูู API (ูุฏ ูุง ูุนูู ุนูู ุฌููุน ุงูุฎูุงุฏู)
<IfModule mod_security.c>
    SecRuleRemoveById 300013
    SecRuleRemoveById 300014
    SecRuleRemoveById 300015
    SecRuleRemoveById 300016
    SecRuleRemoveById 300017
    SecRuleRemoveById 949110
    SecRuleRemoveById 980130
</IfModule>

# ูุงุนุฏุฉ ุฎุงุตุฉ ูููู auth.php ูููุน 403
<Files "auth.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    # ุงูุณูุงุญ ุจุฌููุน ุทุฑู HTTP
    Options +ExecCGI +FollowSymLinks
    # ูุงุนุฏุฉ ุฎุงุตุฉ ูู LiteSpeed
    <IfModule LiteSpeed>
        SetHandler lsapi
        Require all granted
    </IfModule>
</Files>

# ูุญุงููุฉ ุชุฌุงูุฒ ูููุฏ LiteSpeed Security
# ุฅุฐุง ูุงู LiteSpeed ูููุน POSTุ ุฌุฑุจ ูุฐู ุงูููุงุนุฏ
<IfModule LiteSpeed>
    # ุชุนุทูู ุจุนุถ ููุงุนุฏ ุงูุฃูุงู ูู LiteSpeed (ูุฏ ูุง ูุนูู ุนูู ุฌููุน ุงูุฎูุงุฏู)
    # ูุฐู ุงูููุงุนุฏ ุชุญุงูู ุงูุณูุงุญ ุจุทูุจุงุช POST
    <IfModule mod_rewrite.c>
        RewriteEngine On
        # ุงูุณูุงุญ ุจุทูุจุงุช POST ุฅูู auth.php
        RewriteCond %{REQUEST_METHOD} ^POST$
        RewriteCond %{REQUEST_URI} auth\.php$
        RewriteRule ^(.*)$ - [L,E=LSWS_EDC:0]
    </IfModule>
</IfModule>
