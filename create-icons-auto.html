<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª PWA ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2196F3;
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            background: #e3f2fd;
            color: #1976D2;
        }
        .progress {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: #2196F3;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª PWA ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</h1>
        <div class="status" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</div>
        <div class="progress" id="progress" style="display: none;">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
        <div id="results"></div>
    </div>

    <script>
        async function createIcons() {
            const statusDiv = document.getElementById('status');
            const progressDiv = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const resultsDiv = document.getElementById('results');
            
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                statusDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…...';
                progressDiv.style.display = 'block';
                
                const response = await fetch('create-icons-server.php');
                const data = await response.json();
                
                if (data.success) {
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    statusDiv.textContent = 'âœ… ' + data.message;
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                    
                    resultsDiv.innerHTML = `
                        <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
                            <strong>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©:</strong><br>
                            ${data.created.map(size => `âœ… icon-${size}x${size}.png`).join('<br>')}
                            ${data.errors.length > 0 ? '<br><br><strong style="color: red;">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙŠ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§:</strong><br>' + data.errors.map(size => `âŒ icon-${size}x${size}.png`).join('<br>') : ''}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; color: #856404;">
                            <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong><br>
                            Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù…Ø¬Ù„Ø¯ <code>icons/</code>
                        </div>
                    `;
                } else {
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ Ø§Ø³ØªØ®Ø¯Ù… JavaScript
                    statusDiv.textContent = 'Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­...';
                    statusDiv.style.background = '#fff3cd';
                    statusDiv.style.color = '#856404';
                    
                    await createIconsInBrowser();
                }
            } catch (error) {
                // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ Ø§Ø³ØªØ®Ø¯Ù… JavaScript
                console.log('Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript:', error);
                statusDiv.textContent = 'Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­...';
                statusDiv.style.background = '#fff3cd';
                statusDiv.style.color = '#856404';
                
                await createIconsInBrowser();
            }
        }
        
        async function createIconsInBrowser() {
            const statusDiv = document.getElementById('status');
            const progressDiv = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const resultsDiv = document.getElementById('results');
            const logoPath = 'vertopal.com_photo_5922357566287580087_y.png';
            const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
            
            progressDiv.style.display = 'block';
            
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = () => reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬Ùˆ'));
                    img.src = logoPath;
                });
                
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const created = [];
                const errors = [];
                
                for (let i = 0; i < sizes.length; i++) {
                    const size = sizes[i];
                    const progress = ((i + 1) / sizes.length) * 100;
                    progressBar.style.width = progress + '%';
                    progressBar.textContent = Math.round(progress) + '%';
                    
                    try {
                        canvas.width = size;
                        canvas.height = size;
                        
                        // Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, size, size);
                        
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
                        const ratio = Math.min(size / img.width, size / img.height);
                        const newWidth = img.width * ratio;
                        const newHeight = img.height * ratio;
                        
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ù„Ù„ØªÙˆØ³ÙŠØ·
                        const x = (size - newWidth) / 2;
                        const y = (size - newHeight) / 2;
                        
                        // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø©
                        ctx.drawImage(img, x, y, newWidth, newHeight);
                        
                        // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Blob
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                        
                        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… File System Access API Ø£Ùˆ ØªØ­Ù…ÙŠÙ„Ù‡
                        try {
                            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… File System Access API (Chrome/Edge)
                            if ('showSaveFilePicker' in window) {
                                const fileHandle = await window.showSaveFilePicker({
                                    suggestedName: `icon-${size}x${size}.png`,
                                    types: [{
                                        description: 'PNG Image',
                                        accept: { 'image/png': ['.png'] }
                                    }]
                                });
                                const writable = await fileHandle.createWritable();
                                await writable.write(blob);
                                await writable.close();
                                created.push(size);
                            } else {
                                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ØªÙˆÙØ±Ø§Ù‹ØŒ Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
                                const dataUrl = canvas.toDataURL('image/png');
                                const link = document.createElement('a');
                                link.href = dataUrl;
                                link.download = `icon-${size}x${size}.png`;
                                link.style.display = 'none';
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                created.push(size);
                            }
                        } catch (e) {
                            // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ØŒ Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
                            const dataUrl = canvas.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = dataUrl;
                            link.download = `icon-${size}x${size}.png`;
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            created.push(size);
                        }
                    } catch (error) {
                        errors.push(size);
                        console.error(`ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø© ${size}x${size}:`, error);
                    }
                }
                
                statusDiv.textContent = `âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${created.length} Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ù†Ø¬Ø§Ø­!`;
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                
                resultsDiv.innerHTML = `
                    <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
                        <strong>âœ… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©:</strong><br>
                        ${created.map(size => `icon-${size}x${size}.png`).join('<br>')}
                        ${errors.length > 0 ? '<br><br><strong style="color: red;">âŒ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙŠ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§:</strong><br>' + errors.map(size => `icon-${size}x${size}.png`).join('<br>') : ''}
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; color: #856404;">
                        <strong>ğŸ“‹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong><br>
                        1. Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§<br>
                        2. Ø§Ù†Ø³Ø®Ù‡Ø§ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ <code>icons/</code> ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹<br>
                        3. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© (icon-72x72.png, icon-96x96.png, Ø¥Ù„Ø®)<br>
                        4. Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŒ Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ PWA Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                    </div>
                `;
                
            } catch (error) {
                statusDiv.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
            }
        }
        
        // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            createIcons();
        });
    </script>
</body>
</html>
