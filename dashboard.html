<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„ Ù„Ù…Ø­Ù„Ø§Øª ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©">
    <meta name="theme-color" content="#2196F3">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ù‡">
    
    <!-- Windows Meta Tags -->
    <meta name="msapplication-TileColor" content="#2196F3">
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-navbutton-color" content="#2196F3">
    <meta name="msapplication-starturl" content="/index.html">
    <meta name="msapplication-tooltip" content="Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ">
    <meta name="msapplication-window" content="width=1024;height=768">
    
    <!-- Meta Tags Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© -->
    <meta name="application-name" content="Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ù‡">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Open Graph (Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) -->
    <meta property="og:title" content="Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ">
    <meta property="og:type" content="website">
    <meta property="og:image" content="icons/icon-192x192.png">
    
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-96x96.png">
    <link rel="shortcut icon" href="favicon.ico">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="57x57" href="icons/icon-72x72.png">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ -->
    <script src="js/version.js"></script>
    <script>
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù…Ù† window.APP_VERSION (Ù…Ø¹Ø±Ù‘Ù ÙÙŠ version.js)
        // Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªØ¹Ø±ÙŠÙ APP_VERSION Ù„ØªØ¬Ù†Ø¨ Ø®Ø·Ø£ redeclaration
        (function() {
            // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ version.js
            const getAppVersion = function() {
                return window.APP_VERSION || 'v' + Date.now();
            };
            
            const VERSION_PARAM = '?v=' + getAppVersion();
            
            // Ø¥Ø¶Ø§ÙØ© query parameters Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª CSS/JS Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø¹Ø±Ø¶ ÙƒØ§Ø´ Ù‚Ø¯ÙŠÙ…
            document.addEventListener('DOMContentLoaded', function() {
                const version = getAppVersion();
                const versionParam = '?v=' + version;
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª CSS
                const cssLinks = document.querySelectorAll('link[rel="stylesheet"]:not([href^="http"])');
                cssLinks.forEach(link => {
                    if (link.href && !link.href.includes('?')) {
                        link.href = link.href + versionParam;
                    }
                });
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª JS (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ version.js)
                const jsScripts = document.querySelectorAll('script[src]:not([src*="version.js"]):not([src^="http"])');
                jsScripts.forEach(script => {
                    if (script.src && !script.src.includes('?')) {
                        script.src = script.src + versionParam;
                    }
                });
            });
        })();
    </script>
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="css/security.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
  
    <nav class="mobile-navbar" id="mobileNavbar">
        <div class="mobile-nav-container">
            <a href="#dashboard" class="mobile-nav-item active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i>
                <span>Ø§Ù„ØªØ­ÙƒÙ…</span>
            </a>
            <a href="#repairs" class="mobile-nav-item" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i>
                <span>Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
            </a>
            <a href="#customers" class="mobile-nav-item" onclick="showSection('customers')">
                <i class="bi bi-people"></i>
                <span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
            </a>
            <a href="#inventory" class="mobile-nav-item" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i>
                <span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
            </a>
            <a href="#expenses" class="mobile-nav-item" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i>
                <span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
            </a>
            <a href="#reports" class="mobile-nav-item" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </a>
            <a href="#settings" class="mobile-nav-item" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
            <a href="chat.html" class="mobile-nav-item">
                <i class="bi bi-chat-dots"></i>
                <span>Ø§Ù„Ø´Ø§Øª</span>
            </a>
            <a href="#profile" class="mobile-nav-item" onclick="showSection('profile')">
                <i class="bi bi-person-circle"></i>
                <span>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
            </a>
        </div>
    </nav>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="bi bi-phone"></i> Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <a href="#repairs" class="nav-link" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i> Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
            </a>
            <a href="#customers" class="nav-link" onclick="showSection('customers')">
                <i class="bi bi-people"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            </a>
            <a href="#inventory" class="nav-link" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </a>
            <a href="#expenses" class="nav-link" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            </a>
            <a href="#reports" class="nav-link" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            </a>
            <a href="#settings" class="nav-link" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
            <a href="chat.html" class="nav-link">
                <i class="bi bi-chat-dots"></i> Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
            </a>
            <a href="#profile" class="nav-link" onclick="showSection('profile')">
                <i class="bi bi-person-circle"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <p><i class="bi bi-person-circle"></i> <strong id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong></p>
                <p><i class="bi bi-shield-check"></i> <span id="userRole">Ø§Ù„Ø¯ÙˆØ±</span></p>
            </div>
            <button onclick="logout()" class="btn btn-danger btn-sm"><i class="bi bi-box-arrow-right"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
        <header class="top-bar">
            <button class="btn-menu" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
            <h1 id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="header-actions">
                <span id="syncIndicator" class="sync-indicator" onclick="syncManager.manualSync()" title="Ø§Ø¶ØºØ· Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹"><i class="bi bi-arrow-repeat"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <a href="install.html" class="btn btn-icon" title="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" id="installLink" style="display: none;"><i class="bi bi-download"></i></a>
                <button onclick="toggleDarkMode()" class="btn btn-icon" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"><i class="bi bi-moon-stars"></i></button>
            </div>
        </header>

        <div class="content">
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <section id="dashboard-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-receipt-cutoff"></i></div>
                        <div class="stat-info">
                            <h3>Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRepairs">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-currency-exchange"></i></div>
                        <div class="stat-info">
                            <h3>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRevenue">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">ØµØ§ÙÙŠ Ø±Ø¨Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-wallet2"></i></div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©</h3>
                            <p class="stat-value" id="todayExpenses">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ù…ØµØ±ÙˆÙØ§Øª + Ù…Ø®Ø²ÙˆÙ†</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-piggy-bank"></i></div>
                        <div class="stat-info">
                            <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                            <p class="stat-value" id="todayProfit">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</small>
                        </div>
                    </div>
                </div>

                <div class="section-content">
                    <h2>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                    <div class="table-container">
                        <table class="data-table" id="currentRepairsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                </tr>
                            </thead>
                            <tbody id="currentRepairsBody">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
            <section id="repairs-section" class="section"></section>

            <!-- Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
            <section id="profile-section" class="section">
                <div class="section-header">
                    <h2><i class="bi bi-person-circle"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                </div>
                <div class="section-content" id="profile-content">
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            </section>

            <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
            <section id="customers-section" class="section"></section>

            <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
            <section id="inventory-section" class="section"></section>

            <!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
            <section id="expenses-section" class="section"></section>

            <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <section id="reports-section" class="section"></section>

            <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <section id="settings-section" class="section"></section>
        </div>
    </main>

    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data-protection.js"></script>
    <script src="js/security.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/encryption.js"></script>
    <script src="js/encryption-settings.js"></script>
    <script src="js/barcode.js"></script>
    <script src="js/small-label.js"></script>
    <script src="js/image-management.js"></script>
    <script src="js/backup-management.js"></script>
    <script src="js/repairs.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/pwa-install.js"></script>
    <script src="webauthn/webauthn.js"></script>
    <script src="js/profile.js"></script>
    
    <script>
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ« Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('ğŸ”„ ' + event.data.message, 'Version:', event.data.version);
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Service Worker
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Service Worker
            navigator.serviceWorker.getRegistration().then(registration => {
                if (registration) {
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('ğŸ”„ Service Worker updated - reloading...');
                                    window.location.reload();
                                }
                            });
                        }
                    });
                }
            });
        }
    </script>
    
    <script>
        let currentSection = 'dashboard';
        
        // Ù†Ø¸Ø§Ù… Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const PAGE_STORAGE_KEY = 'current_page_section';
        const INVENTORY_TAB_STORAGE_KEY = 'current_inventory_tab';
        
        // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ localStorage
        function saveCurrentPage(section) {
            try {
                localStorage.setItem(PAGE_STORAGE_KEY, section);
                localStorage.setItem(PAGE_STORAGE_KEY + '_timestamp', Date.now().toString());
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', section);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø©:', error);
            }
        }
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† localStorage
        function restoreCurrentPage() {
            try {
                const savedSection = localStorage.getItem(PAGE_STORAGE_KEY);
                if (savedSection) {
                    console.log('ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', savedSection);
                    return savedSection;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø©:', error);
            }
            return 'dashboard';
        }

        // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© - Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        // Ù…ØªØºÙŠØ± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
        let authCheckInProgress = false;
        let authChecked = false;

        let cachedUser = null;
        
        async function performAuthCheck() {
            // Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© - Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù†ØªØ¸Ø±
            if (authCheckInProgress) {
                // Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ø«ÙˆØ§Ù†)
                let waitTime = 0;
                while (authCheckInProgress && waitTime < 5000) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    waitTime += 100;
                }
                return cachedUser;
            }
            
            // Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­ÙÙˆØ¸ØŒ Ø£Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (authChecked && cachedUser) {
                return cachedUser;
            }
            
            authCheckInProgress = true;
            try {
                const user = await checkLogin();
                authCheckInProgress = false;
                authChecked = true;
                
                if (!user) {
                    cachedUser = null;
                    localStorage.clear();
                    sessionStorage.clear();
                    showLoginRequiredMessage();
                    return null;
                }
                
                cachedUser = user;
                return user;
            } catch (error) {
                authCheckInProgress = false;
                authChecked = false;
                cachedUser = null;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                localStorage.clear();
                sessionStorage.clear();
                showLoginRequiredMessage();
                return null;
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', async () => {
            const user = await performAuthCheck();
            if (!user) {
                return;
            }
            
            displayUserInfo();
            hideByPermission();
            loadDarkMode();
            setupModalCloseOnClickOutside();
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
            const initInstallButton = () => {
                const installLink = document.getElementById('installLink');
                if (!installLink) return;
                
                if (typeof pwaInstallManager !== 'undefined') {
                    const installInfo = pwaInstallManager.getInstallInfo();
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø«Ø¨ØªØ§Ù‹ Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Chrome Desktop
                    const browser = pwaInstallManager.getBrowser();
                    const isChromeDesktop = browser === 'chrome' && !pwaInstallManager.isAndroid() && !pwaInstallManager.isIOS();
                    
                    if (!installInfo.isInstalled || isChromeDesktop) {
                        installLink.style.display = 'inline-block';
                    }
                } else {
                    // ØªÙ‡ÙŠØ¦Ø© PWA Install Manager
                    if (typeof PWAInstallManager !== 'undefined') {
                        window.pwaInstallManager = new PWAInstallManager();
                        const installInfo = window.pwaInstallManager.getInstallInfo();
                        const browser = window.pwaInstallManager.getBrowser();
                        const isChromeDesktop = browser === 'chrome' && !window.pwaInstallManager.isAndroid() && !window.pwaInstallManager.isIOS();
                        
                        if (!installInfo.isInstalled || isChromeDesktop) {
                            installLink.style.display = 'inline-block';
                        }
                    }
                }
            };
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙˆØ±ÙŠØ©
            initInstallButton();
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ PWA Manager
            setTimeout(initInstallButton, 500);
            setTimeout(initInstallButton, 1500);
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/'
                    });
                    console.log('âœ… Service Worker registered:', registration);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('ğŸ”„ New Service Worker available. Reload to update.');
                            }
                        });
                    });
                } catch (error) {
                    console.error('âŒ Service Worker registration failed:', error);
                }
            }
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† localStorage
            const savedSection = restoreCurrentPage();
            currentSection = savedSection;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const titles = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'repairs': 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'customers': 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
            };
            if (titles[savedSection]) {
                document.getElementById('pageTitle').textContent = titles[savedSection];
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(`'${savedSection}'`)) {
                    link.classList.add('active');
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${savedSection}'`)) {
                    item.classList.add('active');
                }
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            await loadDashboardData();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            await initializeAutoBackup();
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            loadRepairsSection();
            loadCustomersSection();
            loadInventorySection();
            loadExpensesSection();
            loadReportsSection();
            loadSettingsSection();
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            setTimeout(() => {
                showSection(savedSection, true); // true = Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ (Ù„Ø£Ù†Ù†Ø§ Ø§Ø³ØªØ¹Ø¯Ù†Ø§Ù‡Ø§)
            }, 100);
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡
            setTimeout(() => {
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                    syncManager.startAutoSync();
                }
            }, 3000);
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        window.addEventListener('beforeunload', (event) => {
            // Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
                syncManager.stopAutoSync();
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            if (typeof window.currentCameraStream !== 'undefined' && window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
                window.currentCameraStream = null;
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹
            if (typeof Quagga !== 'undefined') {
                try {
                    Quagga.stop();
                    Quagga.offDetected();
                } catch (e) {
                    console.log('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
            }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (typeof allRepairs !== 'undefined') allRepairs = [];
            if (typeof allCustomers !== 'undefined') allCustomers = [];
            if (typeof allInventory !== 'undefined') allInventory = [];
            if (typeof allExpenses !== 'undefined') allExpenses = [];
            
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            window.removeEventListener('online', () => {});
            window.removeEventListener('offline', () => {});
            window.removeEventListener('resize', () => {});
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø¥Ù„Ù‰ Service Worker
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CLEANUP'
                });
            }
            
            console.log('[Dashboard] ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø®ÙÙŠ');
                    syncManager.stopAutoSync();
                }
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø±Ø¦ÙŠ');
                    syncManager.startAutoSync();
                }
            }
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            sidebar.classList.toggle('show');
        }

        // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function showSection(section, skipSave = false) {
            // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ localStorage (Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† skipSave = true)
            if (!skipSave) {
                saveCurrentPage(section);
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            const targetSection = document.getElementById(`${section}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            } else {
                console.warn('Ø§Ù„Ù‚Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯:', section);
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (section === 'repairs' && typeof loadRepairsSection === 'function') {
                    loadRepairsSection();
                } else if (section === 'customers' && typeof loadCustomersSection === 'function') {
                    loadCustomersSection();
                } else if (section === 'inventory' && typeof loadInventorySection === 'function') {
                    loadInventorySection();
                } else if (section === 'expenses' && typeof loadExpensesSection === 'function') {
                    loadExpensesSection();
                } else if (section === 'reports' && typeof loadReportsSection === 'function') {
                    loadReportsSection();
                } else if (section === 'settings' && typeof loadSettingsSection === 'function') {
                    loadSettingsSection();
                }
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                setTimeout(() => {
                    const retrySection = document.getElementById(`${section}-section`);
                    if (retrySection) {
                        retrySection.classList.add('active');
                    }
                }, 100);
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·
            if (event && event.target) {
                const navLink = event.target.closest('.nav-link');
                if (navLink) {
                    navLink.classList.add('active');
                }
                const mobileNavItem = event.target.closest('.mobile-nav-item');
                if (mobileNavItem) {
                    mobileNavItem.classList.add('active');
                }
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ eventØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(`'${section}'`)) {
                        link.classList.add('active');
                    }
                });
                document.querySelectorAll('.mobile-nav-item').forEach(item => {
                    if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${section}'`)) {
                        item.classList.add('active');
                    }
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            const titles = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'repairs': 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'customers': 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                'profile': 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ'
            };
            if (titles[section]) {
                document.getElementById('pageTitle').textContent = titles[section];
            }
            currentSection = section;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª - Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
            updateSectionData(section, true); // true = Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            updateMobileNavbar(section);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ sidebar ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØªØ¨ÙˆÙŠØ¨
            if (window.innerWidth <= 575.98) {
                const sidebar = document.getElementById('sidebar');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
                if (sidebar) {
                    sidebar.classList.remove('open');
                }
                if (mobileMenuBtn) {
                    mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        async function updateSectionData(section, forceReload = false) {
            try {
                switch (section) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'repairs':
                        if (typeof loadRepairsSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©...');
                                loadRepairsSection();
                            }
                        }
                        break;
                    case 'customers':
                        if (typeof loadCustomersSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...');
                                loadCustomersSection();
                            }
                        }
                        break;
                    case 'inventory':
                        if (typeof loadInventorySection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù… Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†...');
                                loadInventorySection();
                                
                                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                                setTimeout(() => {
                                    const savedTab = localStorage.getItem('current_inventory_tab');
                                    if (savedTab && typeof switchInventoryTab === 'function') {
                                        const tabElement = document.querySelector(`.inventory-tab[onclick*="'${savedTab}'"]`);
                                        if (tabElement) {
                                            switchInventoryTab(savedTab, tabElement);
                                        }
                                    }
                                }, 200);
                            }
                        }
                        break;
                    case 'expenses':
                        if (typeof loadExpensesSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª...');
                                loadExpensesSection();
                            }
                        }
                        break;
                    case 'reports':
                        if (typeof loadReportsSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...');
                                loadReportsSection();
                            }
                        }
                        break;
                    case 'settings':
                        if (typeof loadSettingsSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                                loadSettingsSection();
                            }
                        }
                        break;
                    case 'profile':
                        if (typeof loadProfileSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...');
                                loadProfileSection();
                            }
                        }
                        break;
                }
            } catch (error) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ${section}:`, error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        async function loadDashboardData() {
            const today = getTodayDate();
            const result = await API.getReport('daily', today);
            
            if (result.success) {
                const data = result.data;
                document.getElementById('todayRepairs').textContent = data.repairs_count;
                document.getElementById('todayRevenue').textContent = formatCurrency(data.revenue);
                document.getElementById('todayExpenses').textContent = formatCurrency(data.expenses);
                document.getElementById('todayProfit').textContent = formatCurrency(data.profit);
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const repairsResult = await API.getRepairs();
            if (repairsResult.success) {
                const currentRepairs = repairsResult.data.filter(r => 
                    r.status === 'pending' || r.status === 'in_progress' || r.status === 'ready'
                );
                displayCurrentRepairs(currentRepairs);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function displayCurrentRepairs(repairs) {
            const tbody = document.getElementById('currentRepairsBody');
            
            if (repairs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td></tr>';
                return;
            }
            
            tbody.innerHTML = repairs.slice(0, 10).map(repair => `
                <tr>
                    <td>${repair.repair_number}</td>
                    <td>${repair.customer_name}</td>
                    <td>${repair.device_type} ${repair.device_model || ''}</td>
                    <td><span class="status-badge" style="background: ${getStatusColor(repair.status)}">${getStatusText(repair.status)}</span></td>
                    <td>${formatDate(repair.created_at)}</td>
                </tr>
            `).join('');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            } else {
                sidebar.classList.add('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-x"></i>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function updateMobileNavbar(activeSection) {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + activeSection) {
                    item.classList.add('active');
                }
            });
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (window.innerWidth <= 575.98) {
                if (!sidebar.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                    sidebar.classList.remove('open');
                    if (mobileMenuBtn) {
                        mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
                    }
                }
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (window.innerWidth > 575.98) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            }
        });


    </script>
</body>
</html>

