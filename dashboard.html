<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„ Ù„Ù…Ø­Ù„Ø§Øª ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©">
    <meta name="theme-color" content="#2196F3">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ù‡">
    
    <!-- Windows Meta Tags -->
    <meta name="msapplication-TileColor" content="#2196F3">
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png?v=2.0.1">
    <meta name="msapplication-navbutton-color" content="#2196F3">
    <meta name="msapplication-starturl" content="/index.html">
    <meta name="msapplication-tooltip" content="Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ">
    <meta name="msapplication-window" content="width=1024;height=768">
    
    <!-- Meta Tags Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© -->
    <meta name="application-name" content="Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ù‡">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Open Graph (Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) -->
    <meta property="og:title" content="Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ">
    <meta property="og:type" content="website">
    <meta property="og:image" content="icons/icon-512x512.png?v=2.0.1">
    
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons - Ù…Ø¹ cache busting Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø« Ù†Ø³Ø®Ø© -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-96x96.png?v=2.0.1">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72x72.png?v=2.0.1">
    <link rel="shortcut icon" href="icons/icon-192x192.png?v=2.0.1">
    
    <!-- Apple Touch Icons - Ù…Ø¹ cache busting -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-128x128.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/icon-128x128.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/icon-96x96.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/icon-72x72.png?v=2.0.1">
    <link rel="apple-touch-icon" sizes="57x57" href="icons/icon-72x72.png?v=2.0.1">
    
    <!-- Preconnect Ù„Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Bootstrap Icons - ØªØ­Ù…ÙŠÙ„ Ù…ØªØ£Ø®Ø± (non-blocking) -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"></noscript>
    
    <!-- Preload Critical JS Files - ÙÙŠ head Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙƒØ± -->
    <link rel="preload" href="js/api.js" as="script">
    <link rel="preload" href="js/utils.js" as="script">
    <link rel="preload" href="js/loading-overlay.js" as="script">
    <link rel="preload" href="js/auth.js" as="script">
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ -->
    <script src="js/version.js"></script>
    <script>
        // ğŸ”§ Ø­Ù…Ø§ÙŠØ© ÙÙˆØ±ÙŠØ© Ù…Ù† Service Worker reload Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©)
        (function() {
            // Ù…Ù†Ø¹ reload Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ«
            function shouldPreventReload() {
                try {
                    const justLoggedInTime = sessionStorage.getItem('just_logged_in_time');
                    if (justLoggedInTime) {
                        const timeSinceLogin = Date.now() - parseInt(justLoggedInTime);
                        if (timeSinceLogin < 20000) {
                            console.log('ğŸ›¡ï¸ [Ø­Ù…Ø§ÙŠØ© ÙÙˆØ±ÙŠØ©] Ù…Ù†Ø¹ reload - ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (' + Math.round(timeSinceLogin / 1000) + ' Ø«Ø§Ù†ÙŠØ©)');
                            return true;
                        }
                    }
                    return false;
                } catch (e) {
                    return false;
                }
            }
            
            // Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„Ù…Ù†Ø¹ reload
            window.__PREVENT_SW_RELOAD__ = shouldPreventReload();
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ø¦Ù„ Service Worker Ù…Ø¨ÙƒØ±Ø§Ù‹ (Ù‚Ø¨Ù„ Ø£ÙŠ ÙƒÙˆØ¯ Ø¢Ø®Ø±)
            if ('serviceWorker' in navigator) {
                // Ø¥Ø¶Ø§ÙØ© listener Ù…Ø¨ÙƒØ±Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… capture phase
                window.addEventListener('message', function(event) {
                    if (event.data && event.data.type === 'SW_UPDATED') {
                        if (shouldPreventReload()) {
                            console.log('ğŸ›¡ï¸ [Ø­Ù…Ø§ÙŠØ© ÙÙˆØ±ÙŠØ©] ØªÙ… Ø¥Ù„ØºØ§Ø¡ reload Ù…Ù† Ø±Ø³Ø§Ù„Ø© SW_UPDATED');
                            event.stopImmediatePropagation();
                            event.preventDefault();
                            return false;
                        }
                    }
                }, true);
            }
        })();
    </script>
    <script>
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù…Ù† window.APP_VERSION (Ù…Ø¹Ø±Ù‘Ù ÙÙŠ version.js)
        // Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªØ¹Ø±ÙŠÙ APP_VERSION Ù„ØªØ¬Ù†Ø¨ Ø®Ø·Ø£ redeclaration
        (function() {
            // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ version.js
            const getAppVersion = function() {
                return window.APP_VERSION || 'v' + Date.now();
            };
            
            const VERSION_PARAM = '?v=' + getAppVersion();
            
            // Ø¥Ø¶Ø§ÙØ© query parameters Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª CSS/JS Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø¹Ø±Ø¶ ÙƒØ§Ø´ Ù‚Ø¯ÙŠÙ…
            document.addEventListener('DOMContentLoaded', function() {
                const version = getAppVersion();
                const versionParam = '?v=' + version;
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª CSS
                const cssLinks = document.querySelectorAll('link[rel="stylesheet"]:not([href^="http"])');
                cssLinks.forEach(link => {
                    if (link.href && !link.href.includes('?')) {
                        link.href = link.href + versionParam;
                    }
                });
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª JS (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ version.js)
                const jsScripts = document.querySelectorAll('script[src]:not([src*="version.js"]):not([src^="http"])');
                jsScripts.forEach(script => {
                    if (script.src && !script.src.includes('?')) {
                        script.src = script.src + versionParam;
                    }
                });
            });
        })();
    </script>
    
    <!-- Critical CSS - ØªØ­Ù…ÙŠÙ„ ÙÙˆØ±ÙŠ -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- CSS Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ù„Ù„Ù…ÙˆØ¸Ù -->
    <style id="employee-permissions-style">
        /* Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ */
    </style>
    
    <!-- Loading Overlay CSS - Splash Screen Ù„Ù„ØªØ­Ù…ÙŠÙ„ -->
    <link rel="stylesheet" href="css/loading-overlay.css">
    
    <!-- Non-Critical CSS - ØªØ­Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù† (lazy load) -->
    <link rel="preload" href="css/dark-mode.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/dark-mode.css"></noscript>
    
    <link rel="preload" href="css/security.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/security.css"></noscript>
    
    <!-- Quagga - ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© (lazy load) -->
    <script>
        // ØªØ­Ù…ÙŠÙ„ Quagga ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© (Ø¹Ù†Ø¯ ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯)
        window.loadQuagga = function() {
            if (window.quaggaLoaded) return Promise.resolve();
            window.quaggaLoaded = true;
            
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js';
                script.async = true;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Failed to load Quagga'));
                document.head.appendChild(script);
            });
        };
    </script>
</head>
<body>
  
    <nav class="mobile-navbar" id="mobileNavbar">
        <div class="mobile-nav-container">
            <a href="#dashboard" class="mobile-nav-item active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i>
                <span>Ø§Ù„ØªØ­ÙƒÙ…</span>
            </a>
            <a href="#repairs" class="mobile-nav-item" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i>
                <span>Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
            </a>
            <a href="#customers" class="mobile-nav-item" onclick="showSection('customers')">
                <i class="bi bi-people"></i>
                <span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
            </a>
            <a href="#inventory" class="mobile-nav-item" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i>
                <span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
            </a>
            <a href="pos.html" class="mobile-nav-item">
                <i class="bi bi-cash-coin"></i>
                <span>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹</span>
            </a>
            <a href="chat.html" class="mobile-nav-item">
                <i class="bi bi-chat-dots"></i>
                <span>Ø§Ù„Ø´Ø§Øª</span>
            </a>
            <a href="#expenses" class="mobile-nav-item" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i>
                <span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
            </a>
            <a href="#reports" class="mobile-nav-item" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </a>
            <a href="#settings" class="mobile-nav-item" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
            <a href="error-logs.php" class="mobile-nav-item" data-permission="manager">
                <i class="bi bi-file-earmark-text"></i>
                <span>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</span>
            </a>
        </div>
    </nav>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="" alt="ALAA ZIDAN Logo" class="sidebar-logo" style="display: block;">
            <h2 style="display: none;"><i class="bi bi-phone"></i> Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <a href="#repairs" class="nav-link" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i> Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
            </a>
            <a href="#customers" class="nav-link" onclick="showSection('customers')">
                <i class="bi bi-people"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            </a>
            <a href="#inventory" class="nav-link" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </a>
            <a href="pos.html" class="nav-link">
                <i class="bi bi-cash-coin"></i> Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹
            </a>
            <a href="chat.html" class="nav-link">
                <i class="bi bi-chat-dots"></i> Ø§Ù„Ø´Ø§Øª
            </a>
            <a href="#expenses" class="nav-link" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            </a>
            <a href="#reports" class="nav-link" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            </a>
            <a href="#settings" class="nav-link" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
            <a href="error-logs.php" class="nav-link" data-permission="manager">
                <i class="bi bi-file-earmark-text"></i> Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <p><i class="bi bi-person-circle"></i> <strong id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong></p>
                <p><i class="bi bi-shield-check"></i> <span id="userRole">Ø§Ù„Ø¯ÙˆØ±</span></p>
            </div>
            <button onclick="logout()" class="btn btn-danger btn-sm"><i class="bi bi-box-arrow-right"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
        <header class="top-bar">
            <button class="btn-menu" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
            <h1 id="pageTitle"><i class="bi bi-speedometer2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="header-actions">
                <span id="syncIndicator" class="sync-indicator" onclick="syncManager.manualSync()" title="Ø§Ø¶ØºØ· Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹"><i class="bi bi-arrow-repeat"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <button id="mobileRefreshBtn" class="btn btn-icon mobile-only" onclick="syncManager.manualSync()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"><i class="bi bi-arrow-repeat"></i></button>
                <button id="installButton" class="btn btn-primary hidden" style="display: none; margin-left: 10px; padding: 8px 16px;" title="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">
                    <i class="bi bi-download"></i> <span class="d-none d-md-inline">ØªØ«Ø¨ÙŠØª</span>
                </button>
                <button onclick="toggleDarkMode()" class="btn btn-icon" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"><i class="bi bi-moon-stars"></i></button>
                <button id="notificationsBtn" onclick="toggleNotificationsList()" class="btn btn-icon" title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª" style="position: relative;">
                    <i class="bi bi-bell"></i>
                    <span class="notification-badge" id="notificationBadge" style="display: none; position: absolute; top: -5px; right: -5px; background: var(--danger-color); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center;">0</span>
                </button>
                
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
                <div class="notifications-list" id="notificationsList" style="display: none; position: absolute; top: 100%; right: 0; background: var(--white); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: var(--shadow); max-height: 400px; overflow-y: auto; z-index: 1000; margin-top: 10px; min-width: 300px;">
                    <div class="notifications-header" style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid var(--border-color);">
                        <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: var(--text-dark);">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                        <button class="notifications-close" onclick="toggleNotificationsList()" style="background: none; border: none; font-size: 24px; color: var(--text-light); cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s;">Ã—</button>
                    </div>
                    <div class="notifications-items" style="max-height: 350px; overflow-y: auto;"></div>
                </div>
                <button onclick="showSection('profile')" class="btn btn-icon" title="Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ"><i class="bi bi-person-circle"></i></button>
                <button onclick="logout()" class="btn btn-icon btn-logout" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"><i class="bi bi-box-arrow-right"></i></button>
            </div>
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù‡ÙˆØ§ØªÙ -->
            <div class="mobile-top-user-info">
                <div class="mobile-user-info">
                    <p><i class="bi bi-person-circle"></i> <strong id="mobileUserName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong></p>
                    <p><i class="bi bi-shield-check"></i> <span id="mobileUserRole">Ø§Ù„Ø¯ÙˆØ±</span></p>
                </div>
            </div>
        </header>

        <div class="content">
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <section id="dashboard-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-receipt-cutoff"></i></div>
                        <div class="stat-info">
                            <h3>Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRepairs">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-currency-exchange"></i></div>
                        <div class="stat-info">
                            <h3>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRevenue">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">ØµØ§ÙÙŠ Ø±Ø¨Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-wallet2"></i></div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©</h3>
                            <p class="stat-value" id="todayExpenses">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ù…ØµØ±ÙˆÙØ§Øª + Ù…Ø®Ø²ÙˆÙ†</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-piggy-bank"></i></div>
                        <div class="stat-info">
                            <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                            <p class="stat-value" id="todayProfit">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</small>
                        </div>
                    </div>
                </div>

                <div class="section-content">
                    <h2>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                    <div class="table-container">
                        <table class="data-table" id="currentRepairsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                </tr>
                            </thead>
                            <tbody id="currentRepairsBody">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
            <section id="repairs-section" class="section"></section>

            <!-- Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
            <section id="profile-section" class="section">
                <div class="section-content" id="profile-content">
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            </section>

            <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
            <section id="customers-section" class="section"></section>

            <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
            <section id="inventory-section" class="section"></section>

            <!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
            <section id="expenses-section" class="section"></section>

            <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <section id="reports-section" class="section"></section>

            <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <section id="settings-section" class="section"></section>
        </div>
    </main>

    <!-- Critical Scripts - ØªØ­Ù…ÙŠÙ„ ÙÙˆØ±ÙŠ (Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ) -->
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/global-notifications.js" defer></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Splash Screen Ù„Ù„ØªØ­Ù…ÙŠÙ„ -->
    <script src="js/loading-overlay.js"></script>
    <script src="js/auth.js" defer></script>
    
    <!-- Security Scripts - ØªØ­Ù…ÙŠÙ„ Ù…ØªØ£Ø®Ø± (lazy load Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©) -->
    <script>
        // ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        window.addEventListener('load', () => {
            setTimeout(() => {
                const securityScripts = [
                    { src: 'js/data-protection.js', id: 'data-protection-script' },
                    { src: 'js/security.js', id: 'security-script' }
                ];
                
                securityScripts.forEach(script => {
                    if (!document.getElementById(script.id)) {
                        const el = document.createElement('script');
                        el.id = script.id;
                        el.src = script.src;
                        el.async = true;
                        document.body.appendChild(el);
                    }
                });
            }, 500); // ØªØ£Ø®ÙŠØ± 500ms Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        });
    </script>
    
    <!-- Core Features - ØªØ­Ù…ÙŠÙ„ Ù…ØªØ£Ø®Ø± Ø¬Ø¯Ø§Ù‹ (lazy load) -->
    <script>
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ØºÙŠØ± Ø§Ù„Ø­Ø±Ø¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„
        let coreFeaturesLoaded = false;
        const loadCoreFeatures = () => {
            if (coreFeaturesLoaded) return;
            coreFeaturesLoaded = true;
            
            const scripts = [
                'js/sync.js',
                'js/encryption.js',
                'js/encryption-settings.js'
            ];
            
            scripts.forEach((src, index) => {
                setTimeout(() => {
                    const el = document.createElement('script');
                    el.src = src;
                    el.async = true;
                    document.body.appendChild(el);
                }, index * 100);
            });
        };
        
        // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„ Ø£Ùˆ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
        document.addEventListener('DOMContentLoaded', () => {
            let loaded = false;
            const triggerLoad = () => {
                if (!loaded) {
                    loaded = true;
                    loadCoreFeatures();
                }
            };
            
            // ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„
            ['mousedown', 'touchstart', 'keydown'].forEach(event => {
                document.addEventListener(event, triggerLoad, { once: true, passive: true });
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù† ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
            setTimeout(triggerLoad, 3000);
        });
    </script>
    
    <!-- Module Scripts - ØªØ­Ù…ÙŠÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© (Lazy Loading) -->
    <script>
        // ØªØ­Ù…ÙŠÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© - ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
        (function() {
            const scripts = {
                critical: [
                    { src: 'js/repairs.js', defer: true },
                    { src: 'js/customers.js', defer: true },
                    { src: 'js/inventory.js', defer: true }
                ],
                onDemand: [
                    { src: 'js/barcode.js', id: 'barcode-script' },
                    { src: 'js/small-label.js', id: 'label-script' },
                    { src: 'js/image-management.js', id: 'image-script' },
                    { src: 'js/backup-management.js', id: 'backup-script' },
                    { src: 'js/expenses.js', id: 'expenses-script' },
                    { src: 'js/reports.js', id: 'reports-script' },
                    { src: 'js/settings.js', id: 'settings-script' },
                    { src: 'js/profile.js', id: 'profile-script' },
                    { src: 'js/pwa-install.js', id: 'pwa-script' },
                    { src: 'webauthn/webauthn.js', id: 'webauthn-script' }
                ]
            };
            
            // ØªØ­Ù…ÙŠÙ„ Critical Scripts Ø¨Ø¹Ø¯ DOMContentLoaded Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ±ÙŠ
            document.addEventListener('DOMContentLoaded', () => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ù„Ù„Ù…ÙˆØ¸Ù: ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· (repairs.js, inventory.js)
                const userStr = localStorage.getItem('currentUser');
                const user = userStr ? JSON.parse(userStr) : null;
                const isEmployee = user && user.role === 'employee';
                
                // ØªØµÙÙŠØ© Critical Scripts Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const scriptsToLoad = isEmployee 
                    ? scripts.critical.filter(s => s.src.includes('repairs.js') || s.src.includes('inventory.js'))
                    : scripts.critical;
                
                // Preload Critical Scripts Ø£ÙˆÙ„Ø§Ù‹
                scriptsToLoad.forEach(script => {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.href = script.src;
                    link.as = 'script';
                    document.head.appendChild(link);
                });
                
                // ØªØ£Ø®ÙŠØ± ØªØ­Ù…ÙŠÙ„ Critical Scripts Ø¨Ù…Ù‚Ø¯Ø§Ø± 200ms Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ±ÙŠ
                setTimeout(() => {
                    scriptsToLoad.forEach((script, index) => {
                        // ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ script Ù…Ø¹ ØªØ£Ø®ÙŠØ± ØªØ¯Ø±ÙŠØ¬ÙŠ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†
                        setTimeout(() => {
                            const el = document.createElement('script');
                            el.src = script.src;
                            if (script.defer) el.defer = true;
                            el.async = true; // Ø¥Ø¶Ø§ÙØ© async Ù„Ù„ØªØ­Ù…ÙŠÙ„ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†
                            document.body.appendChild(el);
                        }, index * 100); // ØªØ£Ø®ÙŠØ± 100ms Ø¨ÙŠÙ† ÙƒÙ„ script
                    });
                }, 200);
                
                // ØªØ­Ù…ÙŠÙ„ On-Demand Scripts Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© (Lazy Loading)
                window.loadScriptOnDemand = function(scriptId) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ù„Ù„Ù…ÙˆØ¸Ù: Ù…Ù†Ø¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©
                    const userStr = localStorage.getItem('currentUser');
                    const user = userStr ? JSON.parse(userStr) : null;
                    const isEmployee = user && user.role === 'employee';
                    
                    // Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ù„Ù„Ù…ÙˆØ¸Ù
                    const forbiddenScripts = ['expenses-script', 'reports-script', 'settings-script'];
                    if (isEmployee && forbiddenScripts.includes(scriptId)) {
                        console.log('ğŸš« Ù…Ù†Ø¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù:', scriptId, 'Ù„Ù„Ù…ÙˆØ¸Ù');
                        return Promise.reject(new Error('ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ù…ÙˆØ¸Ù'));
                    }
                    
                    const scriptInfo = scripts.onDemand.find(s => s.id === scriptId);
                    if (!scriptInfo) return Promise.resolve();
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                    if (document.getElementById(scriptInfo.id)) {
                        return Promise.resolve();
                    }
                    
                    return new Promise((resolve, reject) => {
                        const el = document.createElement('script');
                        el.id = scriptInfo.id;
                        el.src = scriptInfo.src;
                        el.defer = true;
                        el.onload = () => resolve();
                        el.onerror = () => reject(new Error(`Failed to load ${scriptInfo.src}`));
                        document.body.appendChild(el);
                    });
                };
                
                // Preload scripts Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„ (passive loading) - ØªØ£Ø®ÙŠØ± Ø£ÙƒØ«Ø±
                // ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¹Ù†Ø¯ hover Ø£Ùˆ click)
                let userInteracted = false;
                const markInteraction = () => {
                    if (userInteracted) return;
                    userInteracted = true;
                    // ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„
                    setTimeout(() => {
                        ['barcode-script', 'label-script'].forEach(id => {
                            window.loadScriptOnDemand(id).catch(() => {});
                        });
                    }, 500);
                };
                
                document.addEventListener('mouseover', markInteraction, { once: true, passive: true });
                document.addEventListener('touchstart', markInteraction, { once: true, passive: true });
            });
        })();
    </script>
    
    <script>
        // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
        let isReloading = false;
        
        // ğŸ”§ Ø§Ù„Ø­Ù„: Ù…Ù†Ø¹ Service Worker reload Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function shouldPreventReload() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            if (window.__PREVENT_SW_RELOAD__ === true) {
                console.log('ğŸ›¡ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ© - Ù…Ù†Ø¹ reload');
                return true;
            }
            
            try {
                const justLoggedInTime = sessionStorage.getItem('just_logged_in_time');
                if (justLoggedInTime) {
                    const timeSinceLogin = Date.now() - parseInt(justLoggedInTime);
                    console.log('ğŸ” ÙØ­Øµ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', {
                        justLoggedInTime,
                        timeSinceLogin,
                        shouldPrevent: timeSinceLogin < 20000
                    });
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (Ø£Ù‚Ù„ Ù…Ù† 20 Ø«Ø§Ù†ÙŠØ©)ØŒ Ù…Ù†Ø¹ reload
                    if (timeSinceLogin < 20000) {
                        console.log('â¸ï¸ Ù…Ù†Ø¹ Service Worker reload - ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (' + Math.round(timeSinceLogin / 1000) + ' Ø«Ø§Ù†ÙŠØ© Ù…Ø¶Øª)');
                        return true;
                    } else {
                        // Ù…Ø³Ø­ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª 20 Ø«Ø§Ù†ÙŠØ©
                        sessionStorage.removeItem('just_logged_in_time');
                        window.__PREVENT_SW_RELOAD__ = false; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ©
                        console.log('âœ… Ù…Ø³Ø­ Ø¹Ù„Ø§Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - ØªØ¬Ø§ÙˆØ²Øª 20 Ø«Ø§Ù†ÙŠØ©');
                    }
                }
                return false;
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ shouldPreventReload:', e);
                return false;
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ« Service Worker - ÙŠØ¬Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ù‡Ø§ Ù‚Ø¨Ù„ Ø£ÙŠ ÙƒÙˆØ¯ Ø¢Ø®Ø± ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ SW
        if ('serviceWorker' in navigator) {
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ø¦Ù„ Service Worker
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('ğŸ“¨ Ø±Ø³Ø§Ù„Ø© Service Worker:', event.data.message, 'Version:', event.data.version);
                    // ğŸ”§ Ø§Ù„Ø­Ù„: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ reload
                    if (shouldPreventReload()) {
                        console.log('â¸ï¸ ØªÙ… Ø¥Ù„ØºØ§Ø¡ reload Ø¨Ø³Ø¨Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (Ù…Ù† Ø±Ø³Ø§Ù„Ø© SW_UPDATED)');
                        return;
                    }
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Service Worker (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)
                    if (!isReloading) {
                        isReloading = true;
                        console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø±Ø³Ø§Ù„Ø© SW_UPDATED...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                }
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Service Worker Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            navigator.serviceWorker.getRegistration().then(registration => {
                if (registration) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                    registration.addEventListener('updatefound', () => {
                        console.log('ğŸ” ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ« Service Worker');
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                console.log('ğŸ“Š Ø­Ø§Ù„Ø© Service Worker Ø§Ù„Ø¬Ø¯ÙŠØ¯:', newWorker.state);
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('ğŸ”„ Service Worker ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...');
                                    // ğŸ”§ Ø§Ù„Ø­Ù„: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ reload
                                    if (shouldPreventReload()) {
                                        console.log('â¸ï¸ ØªÙ… Ø¥Ù„ØºØ§Ø¡ reload Ø¨Ø³Ø¨Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (Ù…Ù† updatefound)');
                                        return;
                                    }
                                    // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
                                    if (!isReloading) {
                                        isReloading = true;
                                        console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ updatefound...');
                                        window.location.reload();
                                    } else {
                                        console.log('âš ï¸ ØªÙ… Ø¥Ù„ØºØ§Ø¡ reload Ø¥Ø¶Ø§ÙÙŠ - reload Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°');
                                    }
                                }
                            });
                        }
                    });
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Service Worker Ù…Ø­Ø¯Ø« ÙŠÙ†ØªØ¸Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„
                    if (registration.waiting) {
                        console.log('ğŸ”„ Service Worker Ù…Ø­Ø¯Ø« Ù…ÙˆØ¬ÙˆØ¯ - Ø³ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„');
                        if (!shouldPreventReload()) {
                            registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        } else {
                            console.log('â¸ï¸ ØªØ£Ø¬ÙŠÙ„ ØªÙØ¹ÙŠÙ„ Service Worker Ø¨Ø³Ø¨Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ«');
                        }
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    setTimeout(async () => {
                        try {
                            await registration.update();
                        } catch (error) {
                            console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Service Worker:', error);
                        }
                    }, 2000);
                }
            }).catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Service Worker registration:', err);
            });
        }
    </script>
    
    <script>
        let currentSection = 'dashboard';
        
        // Ù†Ø¸Ø§Ù… Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const PAGE_STORAGE_KEY = 'current_page_section';
        const INVENTORY_TAB_STORAGE_KEY = 'current_inventory_tab';
        
        // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ localStorage
        function saveCurrentPage(section) {
            try {
                localStorage.setItem(PAGE_STORAGE_KEY, section);
                localStorage.setItem(PAGE_STORAGE_KEY + '_timestamp', Date.now().toString());
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', section);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø©:', error);
            }
        }
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† localStorage
        function restoreCurrentPage() {
            try {
                const savedSection = localStorage.getItem(PAGE_STORAGE_KEY);
                if (savedSection) {
                    console.log('ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', savedSection);
                    return savedSection;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø©:', error);
            }
            return 'dashboard';
        }

        // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© - Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        // Ù…ØªØºÙŠØ± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
        let authCheckInProgress = false;
        let authChecked = false;

        let cachedUser = null;
        
        async function performAuthCheck() {
            // ğŸ”§ Ø§Ù„Ø­Ù„ 5: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« Ù‚Ø¨Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ showLoginRequiredMessage
            const justLoggedInTime = sessionStorage.getItem('just_logged_in_time');
            if (justLoggedInTime) {
                const timeSinceLogin = Date.now() - parseInt(justLoggedInTime);
                // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (Ø£Ù‚Ù„ Ù…Ù† 15 Ø«Ø§Ù†ÙŠØ©)ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù‚Ù‚
                if (timeSinceLogin < 15000) {
                    console.log('â³ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« ÙÙŠ dashboard - Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„...');
                    // Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø¬Ù„Ø³Ø©
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            // Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© - Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù†ØªØ¸Ø±
            if (authCheckInProgress) {
                // Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ø«ÙˆØ§Ù†)
                let waitTime = 0;
                while (authCheckInProgress && waitTime < 5000) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    waitTime += 100;
                }
                return cachedUser;
            }
            
            // Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­ÙÙˆØ¸ØŒ Ø£Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (authChecked && cachedUser) {
                return cachedUser;
            }
            
            authCheckInProgress = true;
            try {
                const user = await checkLogin();
                authCheckInProgress = false;
                authChecked = true;
                
                if (!user) {
                    cachedUser = null;
                    
                    // ğŸ”§ Ø§Ù„Ø­Ù„ 6: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« Ù‚Ø¨Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ showLoginRequiredMessage
                    const justLoggedInTimeCheck = sessionStorage.getItem('just_logged_in_time');
                    if (justLoggedInTimeCheck) {
                        const timeSinceLogin = Date.now() - parseInt(justLoggedInTimeCheck);
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« (Ø£Ù‚Ù„ Ù…Ù† 15 Ø«Ø§Ù†ÙŠØ©)ØŒ Ù„Ø§ Ù†Ø³ØªØ¯Ø¹ÙŠ showLoginRequiredMessage
                        if (timeSinceLogin < 15000) {
                            console.log('â¸ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« - ØªÙ… Ø¥Ù„ØºØ§Ø¡ showLoginRequiredMessage Ù„Ù…Ù†Ø¹ loop');
                            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
                            await new Promise(resolve => setTimeout(resolve, 2000));
                            const retryUser = await checkLogin();
                            if (retryUser) {
                                cachedUser = retryUser;
                                return retryUser;
                            }
                            // Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£ÙŠØ¶Ø§Ù‹ØŒ Ù†Ø±Ø¬Ø¹ null Ø¨Ø¯ÙˆÙ† ØªÙˆØ¬ÙŠÙ‡
                            return null;
                        }
                    }
                    
                    localStorage.clear();
                    sessionStorage.clear();
                    showLoginRequiredMessage();
                    return null;
                }
                
                cachedUser = user;
                return user;
            } catch (error) {
                authCheckInProgress = false;
                authChecked = false;
                cachedUser = null;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                
                // ğŸ”§ Ø§Ù„Ø­Ù„ 7: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« Ù‚Ø¨Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ showLoginRequiredMessage ÙÙŠ catch
                const justLoggedInTimeError = sessionStorage.getItem('just_logged_in_time');
                if (justLoggedInTimeError) {
                    const timeSinceLogin = Date.now() - parseInt(justLoggedInTimeError);
                    if (timeSinceLogin < 15000) {
                        console.log('â¸ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ« ÙÙŠ catch - ØªÙ… Ø¥Ù„ØºØ§Ø¡ showLoginRequiredMessage');
                        return null;
                    }
                }
                
                localStorage.clear();
                sessionStorage.clear();
                showLoginRequiredMessage();
                return null;
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† pos.html (Ù…ØªØºÙŠØ± Ø¹Ø§Ù…)
        let isReturningFromPOS = document.referrer.includes('pos.html') || 
                                  sessionStorage.getItem('returning_from_pos') === 'true';
        
        // Ù…Ø³Ø­ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        if (isReturningFromPOS) {
            sessionStorage.removeItem('returning_from_pos');
            console.log('ğŸ”„ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ - Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', async () => {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
            const logoImg = document.querySelector('.sidebar-logo');
            if (logoImg && typeof getCachedDefaultLogo === 'function') {
                try {
                    const logoUrl = await getCachedDefaultLogo();
                    logoImg.src = logoUrl;
                    logoImg.style.display = 'block';
                    logoImg.onerror = function() {
                        console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„ÙƒØ§Ø´ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
                        logoImg.src = 'vertopal.com_photo_5922357566287580087_y.png';
                    };
                } catch (err) {
                    console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„ÙƒØ§Ø´:', err);
                    logoImg.src = 'vertopal.com_photo_5922357566287580087_y.png';
                    logoImg.style.display = 'block';
                }
            } else if (logoImg) {
                // Fallback: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                logoImg.src = 'vertopal.com_photo_5922357566287580087_y.png';
                logoImg.style.display = 'block';
            }
            
            const user = await performAuthCheck();
            if (!user) {
                return;
            }
            
            displayUserInfo();
            hideByPermission();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„Ù…ÙˆØ¸Ù
            if (typeof setupPermissionObserver === 'function') {
                setupPermissionObserver();
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ hideByPermission Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            setTimeout(() => {
                hideByPermission();
            }, 500);
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ hideByPermission Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            setTimeout(() => {
                hideByPermission();
            }, 2000);
            loadDarkMode();
            setupModalCloseOnClickOutside();
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
            const initInstallButton = () => {
                const installLink = document.getElementById('installLink');
                if (!installLink) return;
                
                if (typeof pwaInstallManager !== 'undefined') {
                    const installInfo = pwaInstallManager.getInstallInfo();
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø«Ø¨ØªØ§Ù‹ Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Chrome Desktop
                    const browser = pwaInstallManager.getBrowser();
                    const isChromeDesktop = browser === 'chrome' && !pwaInstallManager.isAndroid() && !pwaInstallManager.isIOS();
                    
                    if (!installInfo.isInstalled || isChromeDesktop) {
                        installLink.style.display = 'inline-block';
                    }
                } else {
                    // ØªÙ‡ÙŠØ¦Ø© PWA Install Manager
                    if (typeof PWAInstallManager !== 'undefined') {
                        window.pwaInstallManager = new PWAInstallManager();
                        const installInfo = window.pwaInstallManager.getInstallInfo();
                        const browser = window.pwaInstallManager.getBrowser();
                        const isChromeDesktop = browser === 'chrome' && !window.pwaInstallManager.isAndroid() && !window.pwaInstallManager.isIOS();
                        
                        if (!installInfo.isInstalled || isChromeDesktop) {
                            installLink.style.display = 'inline-block';
                        }
                    }
                }
            };
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙˆØ±ÙŠØ©
            initInstallButton();
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ PWA Manager
            setTimeout(initInstallButton, 500);
            setTimeout(initInstallButton, 1500);
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù† - Ù„Ø§ ÙŠØ¹ÙŠÙ‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            // ğŸ”§ Ø¯Ø§Ù„Ø© Ù„Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Service Worker
            const unregisterServiceWorker = async () => {
                if ('serviceWorker' in navigator) {
                    try {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        for (let registration of registrations) {
                            const unregistered = await registration.unregister();
                            console.log('ğŸ—‘ï¸ Service Worker unregistered:', unregistered);
                        }
                        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ caches
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(cacheName => {
                                console.log('ğŸ—‘ï¸ Deleting cache:', cacheName);
                                return caches.delete(cacheName);
                            })
                        );
                        console.log('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Service Worker ÙˆÙ…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ caches');
                        return true;
                    } catch (error) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
                        return false;
                    }
                }
                return false;
            };
            
            // Ø¬Ø¹Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„
            window.unregisterServiceWorker = unregisterServiceWorker;
            
            const registerServiceWorker = async () => {
                if ('serviceWorker' in navigator) {
                    try {
                        const appVersion = '2.0.1';
                        const swUrl = '/sw.js';
                        
                        const registration = await navigator.serviceWorker.register(swUrl, {
                            scope: '/',
                            updateViaCache: 'none'
                        });
                        
                        console.log('âœ… Service Worker registered:', registration);
                        console.log('   - Scope:', registration.scope);
                        console.log('   - Active:', registration.active ? 'Yes' : 'Waiting');
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            if (newWorker) {
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        console.log('ğŸ”„ New Service Worker available. Reload to update.');
                                    }
                                });
                            }
                        });
                        
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    // Ø«Ù… Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø¥ØµØ¯Ø§Ø±
                    const checkForUpdates = async () => {
                        try {
                            console.log('ğŸ”„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª...');
                            await registration.update();
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Service Worker Ù…Ø­Ø¯Ø«
                            if (registration.waiting) {
                                console.log('ğŸ”„ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Service Worker Ù…Ø­Ø¯Ø« - Ø³ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„');
                                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù€ Service Worker Ù„ØªØ®Ø·ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                                registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                            }
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„ÙØ§Øª Ù†ÙØ³Ù‡Ø§
                            if (typeof window.checkForUpdates === 'function') {
                                const hasUpdate = await window.checkForUpdates();
                                if (hasUpdate) {
                                    console.log('ğŸ”„ ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…Ù„ÙØ§Øª - Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„...');
                                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 2000);
                                }
                            }
                        } catch (error) {
                            console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
                        }
                    };
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙˆØ±Ø§Ù‹
                    setTimeout(checkForUpdates, 1000);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
                    setInterval(checkForUpdates, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
                    } catch (error) {
                        console.warn('Service Worker registration failed:', error);
                    }
                }
            };
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            if (window.requestIdleCallback) {
                window.requestIdleCallback(registerServiceWorker, { timeout: 5000 });
            } else {
                setTimeout(registerServiceWorker, 2000);
            }
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† localStorage
            let savedSection = restoreCurrentPage();
            
            // Ù„Ù„Ù…ÙˆØ¸Ù: ØªÙˆØ¬ÙŠÙ‡ Ù…Ø¨Ø§Ø´Ø± Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            const currentUserStr = localStorage.getItem('currentUser');
            const currentUser = currentUserStr ? JSON.parse(currentUserStr) : null;
            const isEmployee = currentUser && currentUser.role === 'employee';
            
            if (isEmployee) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ø¸ÙˆØ±Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¸ÙØŒ Ù†ÙˆØ¬Ù‡Ù‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙŠØ§Ù†Ø©
                // Ù…Ù„Ø§Ø­Ø¸Ø©: profile Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ù…ÙˆØ¸Ù
                const forbiddenSections = ['dashboard', 'customers', 'expenses', 'reports', 'settings'];
                if (!savedSection || forbiddenSections.includes(savedSection)) {
                    savedSection = 'repairs';
                    saveCurrentPage('repairs');
                }
            }
            
            currentSection = savedSection;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const titles = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'repairs': 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'customers': 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
            };
            
            const icons = {
                'dashboard': 'bi-speedometer2',
                'repairs': 'bi-tools',
                'customers': 'bi-people',
                'inventory': 'bi-box-seam',
                'expenses': 'bi-cash-stack',
                'reports': 'bi-graph-up',
                'settings': 'bi-gear',
                'profile': 'bi-person-circle'
            };
            
            if (titles[savedSection]) {
                const pageTitle = document.getElementById('pageTitle');
                const iconClass = icons[savedSection] || 'bi-speedometer2';
                pageTitle.innerHTML = `<i class="bi ${iconClass}"></i> ${titles[savedSection]}`;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(`'${savedSection}'`)) {
                    link.classList.add('active');
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${savedSection}'`)) {
                    item.classList.add('active');
                }
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ù‚ÙˆÙŠ
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
                sec.style.display = 'none';
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
            document.querySelectorAll('.inventory-section').forEach(sec => {
                sec.classList.remove('active');
                sec.style.display = 'none';
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø£Ùˆ dashboard Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ (Ø£Ùˆ repairs Ù„Ù„Ù…ÙˆØ¸Ù)
            const sectionToShow = savedSection || (isEmployee ? 'repairs' : 'dashboard');
            const sectionElement = document.getElementById(sectionToShow + '-section');
            if (sectionElement) {
                sectionElement.classList.add('active');
                sectionElement.style.display = 'block';
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
                document.querySelectorAll('.section').forEach(sec => {
                    if (sec !== sectionElement) {
                        sec.classList.remove('active');
                        sec.style.display = 'none';
                    }
                });
            } else if (sectionToShow === 'dashboard') {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ dashboard-section Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                const dashboardSection = document.getElementById('dashboard-section');
                if (dashboardSection) {
                    dashboardSection.classList.add('active');
                }
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            if (sectionToShow === 'dashboard' && !isEmployee) {
                await loadDashboardData();
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
                setTimeout(async () => {
                    const syncIndicator = document.getElementById('syncIndicator');
                    if (syncIndicator && syncIndicator.style.color === 'var(--danger-color)') {
                        console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
                        await loadDashboardData();
                    }
                }, 3000);
            } else {
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                await updateSectionData(sectionToShow, true);
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            try {
                if (typeof initializeAutoBackup === 'function') {
                    await initializeAutoBackup();
                }
            } catch (e) {
                console.warn('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:', e);
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
            const loadSectionSafely = async (sectionName, loadFunction) => {
                try {
                    // Ù„Ù„Ù‚Ø³Ù… settings Ùˆ profile Ùˆ expensesØŒ Ù†Ø­ØªØ§Ø¬ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script Ø£ÙˆÙ„Ø§Ù‹
                    if (sectionName === 'settings' && typeof loadFunction !== 'function') {
                        await loadScriptOnDemand('settings-script');
                        // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script
                        if (typeof loadSettingsSection === 'function') {
                            await loadSettingsSection();
                        } else {
                            console.warn(`Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ${sectionName} ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script`);
                        }
                    } else if (sectionName === 'profile' && typeof loadFunction !== 'function') {
                        await loadScriptOnDemand('profile-script');
                        // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script
                        if (typeof loadProfileSection === 'function') {
                            await loadProfileSection();
                        } else {
                            console.warn(`Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ${sectionName} ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script`);
                        }
                    } else if (sectionName === 'expenses' && typeof loadFunction !== 'function') {
                        // ğŸ”§ Ø§Ù„Ø­Ù„: ØªØ­Ù…ÙŠÙ„ expenses.js Ù‚Ø¨Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadExpensesSection
                        await loadScriptOnDemand('expenses-script');
                        // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script
                        if (typeof loadExpensesSection === 'function') {
                            await loadExpensesSection();
                        } else {
                            console.warn(`Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ${sectionName} ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ script`);
                        }
                    } else if (typeof loadFunction === 'function') {
                        await loadFunction();
                    } else {
                        console.warn(`Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ${sectionName} ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©`);
                    }
                } catch (e) {
                    console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… ${sectionName}:`, e);
                    // Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ ÙÙ‚Ø· Ù†Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø£
                }
            };
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²ÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
            // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹ÙˆØ¯ Ù…Ù† pos.htmlØŒ Ù†Ø¶ÙŠÙ ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            if (isReturningFromPOS) {
                console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ scripts Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...');
                await new Promise(resolve => setTimeout(resolve, 600));
            }
            
            await Promise.allSettled([
                loadSectionSafely('repairs', typeof loadRepairsSection !== 'undefined' ? loadRepairsSection : undefined),
                loadSectionSafely('customers', typeof loadCustomersSection !== 'undefined' ? loadCustomersSection : undefined),
                loadSectionSafely('inventory', typeof loadInventorySection !== 'undefined' ? loadInventorySection : undefined),
                loadSectionSafely('expenses', typeof loadExpensesSection !== 'undefined' ? loadExpensesSection : undefined),
                loadSectionSafely('reports', typeof loadReportsSection !== 'undefined' ? loadReportsSection : undefined),
                loadSectionSafely('settings', typeof loadSettingsSection !== 'undefined' ? loadSettingsSection : undefined)
            ]);
            
            // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹ÙˆØ¯ Ù…Ù† pos.htmlØŒ Ù†Ø¶ÙŠÙ ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            if (isReturningFromPOS) {
                console.log('â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...');
                await new Promise(resolve => setTimeout(resolve, 400));
            }
            
            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const waitForFunction = (funcName, maxAttempts = 20, delay = 100) => {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const checkFunction = () => {
                        attempts++;
                        if (typeof window[funcName] === 'function') {
                            console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§Ù„Ø© ${funcName} Ø¨Ø¹Ø¯ ${attempts} Ù…Ø­Ø§ÙˆÙ„Ø©`);
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.warn(`âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§Ù„Ø© ${funcName} Ø¨Ø¹Ø¯ ${maxAttempts} Ù…Ø­Ø§ÙˆÙ„Ø©`);
                            reject(new Error(`Function ${funcName} not found`));
                        } else {
                            setTimeout(checkFunction, delay);
                        }
                    };
                    checkFunction();
                });
            };
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            setTimeout(async () => {
                try {
                    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹ÙˆØ¯ Ù…Ù† pos.htmlØŒ Ù†Ø¶ÙŠÙ ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ ÙˆÙ†ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„
                    if (isReturningFromPOS) {
                        console.log('ğŸ”„ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ - Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„...');
                        
                        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
                        const requiredFunctions = {
                            'repairs': 'loadRepairsSection',
                            'customers': 'loadCustomersSection',
                            'inventory': 'loadInventorySection',
                            'expenses': 'loadExpensesSection',
                            'reports': 'loadReportsSection'
                        };
                        
                        const requiredFunc = requiredFunctions[sectionToShow];
                        if (requiredFunc) {
                            try {
                                await waitForFunction(requiredFunc, 30, 150);
                            } catch (e) {
                                console.warn(`âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ${requiredFunc}ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ†Ù‡Ø§`);
                            }
                        }
                        
                        // ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ DOM
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…
                    showSection(sectionToShow, true); // true = Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ (Ù„Ø£Ù†Ù†Ø§ Ø§Ø³ØªØ¹Ø¯Ù†Ø§Ù‡Ø§)
                    
                    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹ÙˆØ¯ Ù…Ù† pos.htmlØŒ Ù†Ø¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„ØªØ£ÙƒØ¯
                    if (isReturningFromPOS) {
                        console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹...');
                        
                        // ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        setTimeout(() => {
                            updateSectionData(sectionToShow, true);
                            
                            // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø£Ø·ÙˆÙ„
                            setTimeout(() => {
                                const targetSection = document.getElementById(`${sectionToShow}-section`);
                                if (targetSection) {
                                    const contentLength = targetSection.innerHTML.trim().length;
                                    if (contentLength < 200) {
                                        console.log('âš ï¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙØ§Ø±ØºØ§Ù‹ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...');
                                        updateSectionData(sectionToShow, true);
                                    }
                                }
                            }, 1000);
                        }, 500);
                    }
                } catch (e) {
                    console.error('Error showing section:', e);
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø¹Ø±Ø¶ dashboard ÙƒØ¨Ø¯ÙŠÙ„
                    const dashboardSection = document.getElementById('dashboard-section');
                    if (dashboardSection) {
                        dashboardSection.classList.add('active');
                    }
                }
            }, isReturningFromPOS ? 800 : 200);
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡
            const initSyncManager = () => {
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                    syncManager.startAutoSync();
                    return true;
                }
                return false;
            };
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙˆØ±ÙŠØ©
            if (!initSyncManager()) {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 1 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    if (!initSyncManager()) {
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                        setTimeout(() => {
                            if (!initSyncManager()) {
                                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                                setTimeout(() => {
                                    if (!initSyncManager()) {
                                        console.warn('[Dashboard] ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ syncManager Ø¨Ø¹Ø¯ Ø¹Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                                        // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹
                                        const syncIndicator = document.getElementById('syncIndicator');
                                        if (syncIndicator) {
                                            syncIndicator.innerHTML = '<i class="bi bi-wifi-off"></i> ØºÙŠØ± Ù…ØªØµÙ„';
                                            syncIndicator.style.color = '#FFA500';
                                        }
                                    }
                                }, 3000);
                            }
                        }, 2000);
                    }
                }, 1000);
            }
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        window.addEventListener('beforeunload', (event) => {
            // Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
                syncManager.stopAutoSync();
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            if (typeof window.currentCameraStream !== 'undefined' && window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
                window.currentCameraStream = null;
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹
            if (typeof Quagga !== 'undefined') {
                try {
                    Quagga.stop();
                    Quagga.offDetected();
                } catch (e) {
                    console.log('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
            }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (typeof allRepairs !== 'undefined') allRepairs = [];
            if (typeof allCustomers !== 'undefined') allCustomers = [];
            if (typeof allInventory !== 'undefined') allInventory = [];
            if (typeof allExpenses !== 'undefined') allExpenses = [];
            
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            window.removeEventListener('online', () => {});
            window.removeEventListener('offline', () => {});
            window.removeEventListener('resize', () => {});
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø¥Ù„Ù‰ Service Worker
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CLEANUP'
                });
            }
            
            console.log('[Dashboard] ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø®ÙÙŠ');
                    syncManager.stopAutoSync();
                }
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø±Ø¦ÙŠ');
                    syncManager.startAutoSync();
                }
            }
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            sidebar.classList.toggle('show');
        }

        // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function showSection(section, skipSave = false) {
            console.log(`ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…: ${section}, isReturningFromPOS: ${isReturningFromPOS}`);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - Ù„Ù„Ù…ÙˆØ¸Ù: Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¨Ù€ (repairs, inventory, pos, chat)
            const userStr = localStorage.getItem('currentUser');
            const user = userStr ? JSON.parse(userStr) : null;
            const isEmployee = user && user.role === 'employee';
            
            if (isEmployee) {
                // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© Ù„Ù„Ù…ÙˆØ¸Ù: repairs, inventory, profile
                // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ù„Ù„Ù…ÙˆØ¸Ù
                const forbiddenSections = ['dashboard', 'customers', 'expenses', 'reports', 'settings'];
                
                if (forbiddenSections.includes(section)) {
                    console.warn('ğŸš« Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ù…Ø­Ø¸ÙˆØ± Ù„Ù„Ù…ÙˆØ¸Ù:', section);
                    showMessage('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…', 'error');
                    // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø© ÙƒØ¨Ø¯ÙŠÙ„
                    section = 'repairs';
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ localStorage (Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† skipSave = true)
            if (!skipSave) {
                saveCurrentPage(section);
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ø´ÙƒÙ„ Ù‚ÙˆÙŠ - Ù…Ù†Ø¹ Ø£ÙŠ ØªØ¹Ø§Ø±Ø¶Ø§Øª
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
                // Ø¥Ø¶Ø§ÙØ© style Ù…Ø¨Ø§Ø´Ø± Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¥Ø®ÙØ§Ø¡
                sec.style.display = 'none';
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† Ø£ÙŠØ¶Ø§Ù‹
            document.querySelectorAll('.inventory-section').forEach(sec => {
                sec.classList.remove('active');
                sec.style.display = 'none';
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            const targetSection = document.getElementById(`${section}-section`);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù‚Ø³Ù…
            const hasContent = targetSection && targetSection.innerHTML.trim().length > 0;
            const hasMinContent = targetSection && targetSection.innerHTML.trim().length > 100;
            
            console.log(`ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø³Ù… ${section}: hasContent=${hasContent}, hasMinContent=${hasMinContent}, length=${targetSection ? targetSection.innerHTML.trim().length : 0}`);
            
            if (targetSection) {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                document.querySelectorAll('.section').forEach(sec => {
                    if (sec !== targetSection) {
                        sec.classList.remove('active');
                        sec.style.display = 'none';
                    }
                });
                
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù‡Ùˆ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                if (section !== 'inventory') {
                    document.querySelectorAll('.inventory-section').forEach(sec => {
                        sec.classList.remove('active');
                        sec.style.display = 'none';
                    });
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… ÙØ§Ø±ØºØ§Ù‹ Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ ÙƒØ§ÙÙØŒ Ù†Ø¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„Ù‡
                if (!hasContent || !hasMinContent) {
                    console.log(`âš ï¸ Ø§Ù„Ù‚Ø³Ù… ${section} ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ ÙƒØ§ÙÙ (${targetSection.innerHTML.trim().length} Ø­Ø±Ù)ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„...`);
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
                    const reloadDelay = isReturningFromPOS ? 500 : 200;
                    setTimeout(() => {
                        if (section === 'repairs' && typeof loadRepairsSection === 'function') {
                            loadRepairsSection();
                        } else if (section === 'customers' && typeof loadCustomersSection === 'function') {
                            loadCustomersSection();
                        } else if (section === 'inventory' && typeof loadInventorySection === 'function') {
                            loadInventorySection();
                        } else if (section === 'expenses' && typeof loadExpensesSection === 'function') {
                            loadExpensesSection();
                        } else if (section === 'reports' && typeof loadReportsSection === 'function') {
                            loadReportsSection();
                        } else {
                            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªÙˆÙØ±Ø©ØŒ Ù†Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ù†Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                            setTimeout(() => {
                                updateSectionData(section, true);
                            }, 500);
                        }
                    }, reloadDelay);
                }
            } else {
                console.warn('Ø§Ù„Ù‚Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯:', section);
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (section === 'repairs' && typeof loadRepairsSection === 'function') {
                    loadRepairsSection();
                } else if (section === 'customers' && typeof loadCustomersSection === 'function') {
                    loadCustomersSection();
                } else if (section === 'inventory' && typeof loadInventorySection === 'function') {
                    loadInventorySection();
                } else if (section === 'expenses' && typeof loadExpensesSection === 'function') {
                    loadExpensesSection();
                } else if (section === 'reports' && typeof loadReportsSection === 'function') {
                    loadReportsSection();
                } else if (section === 'settings') {
                    // ØªØ­Ù…ÙŠÙ„ settings.js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                    if (typeof loadSettingsSection !== 'function') {
                        loadScriptOnDemand('settings-script').then(() => {
                            if (typeof loadSettingsSection === 'function') {
                                loadSettingsSection();
                            } else {
                                console.error('loadSettingsSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ settings.js');
                                const settingsSection = document.getElementById('settings-section');
                                if (settingsSection) {
                                    settingsSection.innerHTML = `
                                        <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                            <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                            <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
                                            <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                            </button>
                                        </div>
                                    `;
                                }
                            }
                        }).catch(err => {
                            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ settings.js:', err);
                            const settingsSection = document.getElementById('settings-section');
                            if (settingsSection) {
                                settingsSection.innerHTML = `
                                    <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                        <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
                                        <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                        </button>
                                    </div>
                                `;
                            }
                        });
                    } else {
                        loadSettingsSection();
                    }
                } else if (section === 'profile') {
                    // ØªØ­Ù…ÙŠÙ„ profile.js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                    if (typeof loadProfileSection !== 'function') {
                        loadScriptOnDemand('profile-script').then(() => {
                            if (typeof loadProfileSection === 'function') {
                                loadProfileSection();
                            }
                        }).catch(err => {
                            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ profile.js:', err);
                        });
                    } else {
                        loadProfileSection();
                    }
                }
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                setTimeout(() => {
                    const retrySection = document.getElementById(`${section}-section`);
                    if (retrySection) {
                        retrySection.classList.add('active');
                    }
                }, 100);
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            if (section === 'profile') {
                // ØªØ­Ù…ÙŠÙ„ profile.js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                if (typeof loadProfileSection !== 'function') {
                    loadScriptOnDemand('profile-script').then(() => {
                        if (typeof loadProfileSection === 'function') {
                            loadProfileSection();
                        }
                    }).catch(err => {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ profile.js:', err);
                    });
                } else {
                    loadProfileSection();
                }
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·
            if (event && event.target) {
                const navLink = event.target.closest('.nav-link');
                if (navLink) {
                    navLink.classList.add('active');
                }
                const mobileNavItem = event.target.closest('.mobile-nav-item');
                if (mobileNavItem) {
                    mobileNavItem.classList.add('active');
                }
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ eventØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(`'${section}'`)) {
                        link.classList.add('active');
                    }
                });
                document.querySelectorAll('.mobile-nav-item').forEach(item => {
                    if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${section}'`)) {
                        item.classList.add('active');
                    }
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            const titles = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'repairs': 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'customers': 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                'profile': 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ'
            };
            
            const icons = {
                'dashboard': 'bi-speedometer2',
                'repairs': 'bi-tools',
                'customers': 'bi-people',
                'inventory': 'bi-box-seam',
                'expenses': 'bi-cash-stack',
                'reports': 'bi-graph-up',
                'settings': 'bi-gear',
                'profile': 'bi-person-circle'
            };
            
            if (titles[section]) {
                const pageTitle = document.getElementById('pageTitle');
                const iconClass = icons[section] || 'bi-speedometer2';
                pageTitle.innerHTML = `<i class="bi ${iconClass}"></i> ${titles[section]}`;
            }
            currentSection = section;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª - Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ø£Ù† DOM Ø¬Ø§Ù‡Ø²
            const updateDelay = isReturningFromPOS ? 300 : 100;
            setTimeout(() => {
                updateSectionData(section, true); // true = Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
            }, updateDelay);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            updateMobileNavbar(section);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ sidebar ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØªØ¨ÙˆÙŠØ¨
            if (window.innerWidth <= 575.98) {
                const sidebar = document.getElementById('sidebar');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
                if (sidebar) {
                    sidebar.classList.remove('open');
                }
                if (mobileMenuBtn) {
                    mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        async function updateSectionData(section, forceReload = false) {
            try {
                // ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¶Ù…Ø§Ù† Ø£Ù† DOM Ø¬Ø§Ù‡Ø² ØªÙ…Ø§Ù…Ø§Ù‹
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù‡Ùˆ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø· Ø§Ù„ÙˆØ­ÙŠØ¯
                const targetSection = document.getElementById(`${section}-section`);
                if (targetSection) {
                    const isActive = targetSection.classList.contains('active');
                    if (!isActive) {
                        console.log(`âš ï¸ Ø§Ù„Ù‚Ø³Ù… ${section} ØºÙŠØ± Ù†Ø´Ø·ØŒ Ù„Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);
                        return;
                    }
                    
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
                    document.querySelectorAll('.section').forEach(sec => {
                        if (sec !== targetSection) {
                            sec.classList.remove('active');
                            sec.style.display = 'none';
                        }
                    });
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù‡Ùˆ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    if (section !== 'inventory') {
                        document.querySelectorAll('.inventory-section').forEach(sec => {
                            sec.classList.remove('active');
                            sec.style.display = 'none';
                        });
                    }
                }
                
                switch (section) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'repairs':
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©
                        let attempts = 0;
                        const checkRepairsFunction = () => {
                            if (typeof loadRepairsSection === 'function') {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©...');
                                const repairsSection = document.getElementById('repairs-section');
                                if (repairsSection) {
                                    repairsSection.classList.add('active');
                                }
                                loadRepairsSection();
                            } else if (attempts < 10) {
                                attempts++;
                                setTimeout(checkRepairsFunction, 150);
                            } else {
                                console.warn('âš ï¸ loadRepairsSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                            }
                        };
                        
                        if (forceReload) {
                            checkRepairsFunction();
                        }
                        break;
                    case 'customers':
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©
                        let customerAttempts = 0;
                        const checkCustomersFunction = () => {
                            if (typeof loadCustomersSection === 'function') {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...');
                                const customersSection = document.getElementById('customers-section');
                                if (customersSection) {
                                    customersSection.classList.add('active');
                                }
                                loadCustomersSection();
                            } else if (customerAttempts < 10) {
                                customerAttempts++;
                                setTimeout(checkCustomersFunction, 150);
                            } else {
                                console.warn('âš ï¸ loadCustomersSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                            }
                        };
                        
                        if (forceReload) {
                            checkCustomersFunction();
                        }
                        break;
                    case 'inventory':
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©
                        let inventoryAttempts = 0;
                        const checkInventoryFunction = () => {
                            if (typeof loadInventorySection === 'function') {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†...');
                                
                                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙ…Ø±Ø¦ÙŠ
                                const inventorySection = document.getElementById('inventory-section');
                                if (!inventorySection) {
                                    console.warn('âš ï¸ Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                                    return;
                                }
                                
                                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù‡Ùˆ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø· Ø§Ù„ÙˆØ­ÙŠØ¯
                                const isActive = inventorySection.classList.contains('active');
                                if (!isActive) {
                                    console.log('âš ï¸ Ù‚Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± Ù†Ø´Ø·ØŒ Ù„Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰');
                                    return;
                                }
                                
                                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
                                document.querySelectorAll('.section').forEach(sec => {
                                    if (sec !== inventorySection) {
                                        sec.classList.remove('active');
                                        sec.style.display = 'none';
                                    }
                                });
                                
                                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                                loadInventorySection();
                                
                                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                                setTimeout(() => {
                                    const savedTab = localStorage.getItem('current_inventory_tab') || 'spare_parts';
                                    if (typeof switchInventoryTab === 'function') {
                                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø¹Ù†ØµØ±
                                        const tabElement = document.querySelector(`.inventory-tab[onclick*="'${savedTab}'"]`);
                                        if (tabElement) {
                                            switchInventoryTab(savedTab, tabElement);
                                        } else {
                                            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø§Ù„Ø¹Ù†ØµØ±ØŒ Ù†Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ù†Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                                            setTimeout(() => {
                                                const retryTabElement = document.querySelector(`.inventory-tab[onclick*="'${savedTab}'"]`);
                                                if (retryTabElement) {
                                                    switchInventoryTab(savedTab, retryTabElement);
                                                } else {
                                                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                                                    console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                                                    const defaultTab = document.querySelector('.inventory-tab');
                                                    if (defaultTab) {
                                                        switchInventoryTab('spare_parts', defaultTab);
                                                    }
                                                }
                                            }, 500);
                                        }
                                    }
                                }, 500);
                            } else if (inventoryAttempts < 15) {
                                inventoryAttempts++;
                                setTimeout(checkInventoryFunction, 150);
                            } else {
                                console.warn('âš ï¸ loadInventorySection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 15 Ù…Ø­Ø§ÙˆÙ„Ø©ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ inventory.js...');
                                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ inventory.js ÙŠØ¯ÙˆÙŠØ§Ù‹
                                const script = document.createElement('script');
                                script.src = 'js/inventory.js';
                                script.defer = true;
                                script.onload = () => {
                                    setTimeout(() => {
                                        if (typeof loadInventorySection === 'function') {
                                            loadInventorySection();
                                        }
                                    }, 200);
                                };
                                document.body.appendChild(script);
                            }
                        };
                        
                        if (forceReload) {
                            checkInventoryFunction();
                        }
                        break;
                    case 'expenses':
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©
                        let expensesAttempts = 0;
                        const checkExpensesFunction = () => {
                            if (typeof loadExpensesSection === 'function') {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª...');
                                const expensesSection = document.getElementById('expenses-section');
                                if (expensesSection) {
                                    expensesSection.classList.add('active');
                                }
                                loadExpensesSection();
                            } else if (expensesAttempts < 10) {
                                expensesAttempts++;
                                setTimeout(checkExpensesFunction, 150);
                            } else {
                                console.warn('âš ï¸ loadExpensesSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                            }
                        };
                        
                        if (forceReload) {
                            checkExpensesFunction();
                        }
                        break;
                    case 'reports':
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©
                        let reportsAttempts = 0;
                        const checkReportsFunction = () => {
                            if (typeof loadReportsSection === 'function') {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...');
                                const reportsSection = document.getElementById('reports-section');
                                if (reportsSection) {
                                    reportsSection.classList.add('active');
                                }
                                loadReportsSection();
                            } else if (reportsAttempts < 10) {
                                reportsAttempts++;
                                setTimeout(checkReportsFunction, 150);
                            } else {
                                console.warn('âš ï¸ loadReportsSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
                            }
                        };
                        
                        if (forceReload) {
                            checkReportsFunction();
                        }
                        break;
                    case 'settings':
                        // ØªØ­Ù…ÙŠÙ„ settings.js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                        if (typeof loadSettingsSection !== 'function') {
                            console.log('ğŸ“¦ ØªØ­Ù…ÙŠÙ„ settings.js...');
                            await loadScriptOnDemand('settings-script').catch(err => {
                                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ settings.js:', err);
                            });
                        }
                        
                        if (typeof loadSettingsSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                                try {
                                    await loadSettingsSection();
                                } catch (settingsError) {
                                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', settingsError);
                                    const settingsSection = document.getElementById('settings-section');
                                    if (settingsSection) {
                                        settingsSection.innerHTML = `
                                            <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                                <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                                <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
                                                <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                                </button>
                                            </div>
                                        `;
                                    }
                                }
                            }
                        } else {
                            console.error('loadSettingsSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                            const settingsSection = document.getElementById('settings-section');
                            if (settingsSection) {
                                settingsSection.innerHTML = `
                                    <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                        <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
                                        <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                        </button>
                                    </div>
                                `;
                            }
                        }
                        break;
                    case 'profile':
                        // ØªØ­Ù…ÙŠÙ„ profile.js Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                        if (typeof loadProfileSection !== 'function') {
                            console.log('ğŸ“¦ ØªØ­Ù…ÙŠÙ„ profile.js...');
                            await loadScriptOnDemand('profile-script').catch(err => {
                                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ profile.js:', err);
                            });
                        }
                        
                        if (typeof loadProfileSection === 'function') {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù‚Ø³Ù…
                            if (forceReload) {
                                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...');
                                try {
                                    await loadProfileSection();
                                } catch (profileError) {
                                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', profileError);
                                    const profileContent = document.getElementById('profile-content');
                                    if (profileContent) {
                                        profileContent.innerHTML = `
                                            <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                                <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                                <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</p>
                                                <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                                </button>
                                            </div>
                                        `;
                                    }
                                }
                            }
                        } else {
                            console.error('loadProfileSection ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                            const profileContent = document.getElementById('profile-content');
                            if (profileContent) {
                                profileContent.innerHTML = `
                                    <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                                        <i class="bi bi-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                        <p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</p>
                                        <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                                        </button>
                                    </div>
                                `;
                            }
                        }
                        break;
                }
            } catch (error) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ${section}:`, error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        async function loadDashboardData() {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù‡ÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø·
            const dashboardSection = document.getElementById('dashboard-section');
            if (!dashboardSection) {
                console.error('âŒ Ù‚Ø³Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù‡ÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø· Ø§Ù„ÙˆØ­ÙŠØ¯
            const isActive = dashboardSection.classList.contains('active');
            if (!isActive) {
                console.log('âš ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ØºÙŠØ± Ù†Ø´Ø·Ø©ØŒ Ù„Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
            document.querySelectorAll('.section').forEach(sec => {
                if (sec !== dashboardSection) {
                    sec.classList.remove('active');
                    sec.style.display = 'none';
                }
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
            document.querySelectorAll('.inventory-section').forEach(sec => {
                sec.classList.remove('active');
                sec.style.display = 'none';
            });
            
            const syncIndicator = document.getElementById('syncIndicator');
            let hasError = false;
            let errorMessage = '';
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… getTodayDate Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹ Ø£Ùˆ fallback
                const getTodayDateFunc = typeof getTodayDate === 'function' ? getTodayDate : () => {
                    const today = new Date();
                    return today.toISOString().split('T')[0];
                };
                const today = getTodayDateFunc();
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… formatCurrency Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹ Ø£Ùˆ fallback (ØªØ¹Ø±ÙŠÙ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·)
                const formatCurrencyFunc = typeof formatCurrency === 'function' ? formatCurrency : (amount) => {
                    return parseFloat(amount || 0).toFixed(2) + ' Ø¬.Ù…';
                };
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                if (syncIndicator) {
                    syncIndicator.innerHTML = '<i class="bi bi-arrow-repeat"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
                    syncIndicator.style.color = '';
                }
                
                // ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                let reportData = null;
                try {
                    const result = await API.getReport('daily', today);
                    if (result && result.success && result.data) {
                        reportData = result.data;
                    } else {
                        console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…:', result?.message || 'Unknown error');
                        if (result?.message) {
                            errorMessage = result.message;
                            hasError = true;
                        }
                    }
                } catch (reportError) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…:', reportError);
                    hasError = true;
                    if (reportError.message) {
                        errorMessage = reportError.message;
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
                const todayRepairsEl = document.getElementById('todayRepairs');
                const todayRevenueEl = document.getElementById('todayRevenue');
                const todayExpensesEl = document.getElementById('todayExpenses');
                const todayProfitEl = document.getElementById('todayProfit');
                
                if (reportData) {
                    if (todayRepairsEl) todayRepairsEl.textContent = reportData.repairs_count || 0;
                    if (todayRevenueEl) todayRevenueEl.textContent = formatCurrencyFunc(reportData.revenue || 0);
                    if (todayExpensesEl) todayExpensesEl.textContent = formatCurrencyFunc(reportData.expenses || 0);
                    if (todayProfitEl) todayProfitEl.textContent = formatCurrencyFunc(reportData.profit || 0);
                } else {
                    // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ØŒ Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    if (todayRepairsEl) todayRepairsEl.textContent = '0';
                    if (todayRevenueEl) todayRevenueEl.textContent = formatCurrencyFunc(0);
                    if (todayExpensesEl) todayExpensesEl.textContent = formatCurrencyFunc(0);
                    if (todayProfitEl) todayProfitEl.textContent = formatCurrencyFunc(0);
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                try {
                    const repairsResult = await API.getRepairs();
                    if (repairsResult && repairsResult.success && repairsResult.data) {
                        const currentRepairs = repairsResult.data.filter(r => 
                            r && (r.status === 'pending' || r.status === 'in_progress' || r.status === 'ready')
                        );
                        displayCurrentRepairs(currentRepairs);
                    } else {
                        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©" ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
                        displayCurrentRepairs([]);
                        if (repairsResult?.message) {
                            console.warn('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:', repairsResult.message);
                            if (!errorMessage) {
                                errorMessage = repairsResult.message;
                                hasError = true;
                            }
                        }
                    }
                } catch (repairsError) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:', repairsError);
                    displayCurrentRepairs([]);
                    if (repairsError.message && !errorMessage) {
                        errorMessage = repairsError.message;
                        hasError = true;
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                if (syncIndicator) {
                    if (hasError) {
                        syncIndicator.innerHTML = '<i class="bi bi-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                        syncIndicator.style.color = 'var(--danger-color)';
                        syncIndicator.title = errorMessage || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    } else {
                        syncIndicator.innerHTML = '<i class="bi bi-check-circle"></i> Ù…Ø­Ø¯Ø«';
                        syncIndicator.style.color = 'var(--success-color)';
                        syncIndicator.title = 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
                        setTimeout(() => {
                            if (syncIndicator) {
                                const now = new Date();
                                const timeStr = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', timeZone: 'Africa/Cairo' });
                                // Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© refresh Ø¯Ø§Ø¦Ù…Ø§Ù‹
                                const isMobile = window.innerWidth <= 575.98;
                                const iconClass = isMobile ? 'bi-arrow-repeat' : 'bi-check-circle';
                                syncIndicator.innerHTML = `<i class="bi ${iconClass}"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeStr}`;
                                syncIndicator.title = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeStr}`;
                            }
                        }, 1000);
                    }
                }
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ Ø­Ù‚ÙŠÙ‚ÙŠ
                if (hasError && errorMessage) {
                    // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø­Ù…Ù„Ø© (Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø¬Ø²Ø¡ Ù…Ù†Ù‡Ø§)
                    if (!reportData) {
                        showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + errorMessage, 'error');
                    }
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…:', error);
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                const todayRepairsEl = document.getElementById('todayRepairs');
                const todayRevenueEl = document.getElementById('todayRevenue');
                const todayExpensesEl = document.getElementById('todayExpenses');
                const todayProfitEl = document.getElementById('todayProfit');
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… formatCurrency Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹ Ø£Ùˆ fallback
                const formatCurrencyFunc = typeof formatCurrency === 'function' ? formatCurrency : (amount) => {
                    return parseFloat(amount || 0).toFixed(2) + ' Ø¬.Ù…';
                };
                
                if (todayRepairsEl) todayRepairsEl.textContent = '0';
                if (todayRevenueEl) todayRevenueEl.textContent = formatCurrencyFunc(0);
                if (todayExpensesEl) todayExpensesEl.textContent = formatCurrencyFunc(0);
                if (todayProfitEl) todayProfitEl.textContent = formatCurrencyFunc(0);
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                displayCurrentRepairs([]);
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£
                if (syncIndicator) {
                    syncIndicator.innerHTML = '<i class="bi bi-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                    syncIndicator.style.color = 'var(--danger-color)';
                    syncIndicator.title = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                }
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + (error.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'), 'error');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function displayCurrentRepairs(repairs) {
            const tbody = document.getElementById('currentRepairsBody');
            if (!tbody) {
                console.warn('currentRepairsBody element not found');
                return;
            }
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (!repairs || !Array.isArray(repairs) || repairs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td></tr>';
                    return;
                }
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø£Ùˆ fallback
                const formatDateFunc = typeof formatDate === 'function' ? formatDate : (date) => {
                    if (!date) return '-';
                    try {
                        return new Date(date).toLocaleDateString('ar-EG', { timeZone: 'Africa/Cairo' });
                    } catch (e) {
                        return '-';
                    }
                };
                const getStatusColorFunc = typeof getStatusColor === 'function' ? getStatusColor : (status) => {
                    const colors = {
                        'pending': '#FFA500',
                        'in_progress': '#2196F3',
                        'ready': '#4CAF50',
                        'delivered': '#4CAF50',
                        'cancelled': '#f44336'
                    };
                    return colors[status] || '#999';
                };
                const getStatusTextFunc = typeof getStatusText === 'function' ? getStatusText : (status) => {
                    const statuses = {
                        'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                        'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­',
                        'ready': 'Ø¬Ø§Ù‡Ø²',
                        'delivered': 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
                        'cancelled': 'Ù…Ù„ØºÙŠ'
                    };
                    return statuses[status] || status || '-';
                };
                
                // Ø¨Ù†Ø§Ø¡ HTML Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
                const rows = repairs.slice(0, 10)
                    .filter(repair => repair && typeof repair === 'object')
                    .map(repair => {
                        try {
                            const repairNumber = (repair.repair_number || '-').toString().trim();
                            const customerName = (repair.customer_name || '-').toString().trim();
                            const deviceType = (repair.device_type || '').toString().trim();
                            const deviceModel = (repair.device_model || '').toString().trim();
                            const deviceInfo = (deviceType + ' ' + deviceModel).trim() || '-';
                            const status = repair.status || '';
                            const statusColor = getStatusColorFunc(status);
                            const statusText = getStatusTextFunc(status);
                            const date = formatDateFunc(repair.created_at || repair.created_date);
                            
                            return `
                                <tr>
                                    <td>${repairNumber}</td>
                                    <td>${customerName}</td>
                                    <td>${deviceInfo}</td>
                                    <td><span class="status-badge" style="background: ${statusColor}">${statusText}</span></td>
                                    <td>${date}</td>
                                </tr>
                            `;
                        } catch (rowError) {
                            console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙ:', rowError, repair);
                            return '';
                        }
                    })
                    .filter(row => row && row.trim().length > 0);
                
                if (rows.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td></tr>';
                } else {
                    tbody.innerHTML = rows.join('');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:', error);
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--danger-color);">Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotifications() {
            showMessage('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'info');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            } else {
                sidebar.classList.add('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-x"></i>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function updateMobileNavbar(activeSection) {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + activeSection) {
                    item.classList.add('active');
                }
            });
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (window.innerWidth <= 575.98) {
                if (!sidebar.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                    sidebar.classList.remove('open');
                    if (mobileMenuBtn) {
                        mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
                    }
                }
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn') || document.querySelector('.btn-menu');
            
            if (!sidebar || !mobileMenuBtn) return;
            
            if (window.innerWidth > 575.98) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            }
        });

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø«Ù„ Ø§Ù„Ø´Ø§Øª)
        let notifications = [];
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† localStorage
        function loadNotifications() {
            try {
                const stored = localStorage.getItem('chat_notifications');
                if (stored) {
                    notifications = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', e);
                notifications = [];
            }
            updateNotificationBadge();
        }
        
        function toggleNotificationsList() {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            const isVisible = notificationsList.style.display !== 'none';
            notificationsList.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                renderNotificationsList();
            }
        }
        
        function renderNotificationsList() {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            const list = notificationsList.querySelector('.notifications-items');
            if (!list) return;
            
            list.innerHTML = '';
            
            if (notifications.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 40px 20px; font-size: 16px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>';
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            notifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = 'notification-item';
                item.style.cssText = 'display: flex; align-items: center; gap: 10px; padding: 12px 15px; border-bottom: 1px solid var(--border-color); transition: background 0.2s;';
                
                const content = document.createElement('div');
                content.className = 'notification-content';
                content.style.cssText = 'flex: 1; min-width: 0;';
                
                const username = document.createElement('div');
                username.className = 'notification-username';
                username.style.cssText = 'font-size: 13px; font-weight: 600; color: var(--text-dark); margin-bottom: 4px;';
                username.textContent = notification.username || 'Ù…Ø³ØªØ®Ø¯Ù…';
                
                const message = document.createElement('div');
                message.className = 'notification-message';
                message.style.cssText = 'font-size: 12px; color: var(--text-light); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 4px;';
                message.textContent = notification.message || '';
                
                const time = document.createElement('div');
                time.className = 'notification-time';
                time.style.cssText = 'font-size: 11px; color: var(--text-light); opacity: 0.7;';
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… formatTime Ù…Ù† chat.js Ø£Ùˆ formatDateTime Ù…Ù† utils.js
                if (typeof formatTime === 'function') {
                    time.textContent = formatTime(notification.timestamp);
                } else if (typeof formatDateTime === 'function') {
                    time.textContent = formatDateTime(notification.timestamp);
                } else {
                    time.textContent = new Date(notification.timestamp).toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' });
                }
                
                content.appendChild(username);
                content.appendChild(message);
                content.appendChild(time);
                
                item.appendChild(content);
                
                // Ø²Ø± Ø§Ù„Ø­Ø°Ù
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'notification-delete';
                deleteBtn.style.cssText = 'background: none; border: none; color: var(--text-light); cursor: pointer; padding: 5px; font-size: 16px; opacity: 0.5; transition: opacity 0.2s;';
                deleteBtn.innerHTML = 'Ã—';
                deleteBtn.onclick = () => deleteNotification(notification.id);
                deleteBtn.onmouseenter = () => deleteBtn.style.opacity = '1';
                deleteBtn.onmouseleave = () => deleteBtn.style.opacity = '0.5';
                
                item.appendChild(deleteBtn);
                fragment.appendChild(item);
            });
            
            list.appendChild(fragment);
            updateNotificationBadge();
        }
        
        function deleteNotification(notificationId) {
            notifications = notifications.filter(n => n.id !== notificationId);
            
            try {
                localStorage.setItem('chat_notifications', JSON.stringify(notifications));
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', e);
            }
            
            renderNotificationsList();
        }
        
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                if (notifications.length > 0) {
                    badge.textContent = notifications.length > 99 ? '99+' : notifications.length;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadNotifications);
        } else {
            loadNotifications();
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const notificationsList = document.getElementById('notificationsList');
            const notificationsBtn = document.getElementById('notificationsBtn');
            
            if (!notificationsList || !notificationsBtn) return;
            
            if (!notificationsList.contains(event.target) && !notificationsBtn.contains(event.target)) {
                notificationsList.style.display = 'none';
            }
        });

    </script>
</body>
</html>

