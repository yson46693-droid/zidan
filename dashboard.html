<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„ Ù„Ù…Ø­Ù„Ø§Øª ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©">
    <meta name="theme-color" content="#2196F3">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ ØµÙŠØ§Ù†Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon.svg">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon.svg">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="css/security.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
  
    <nav class="mobile-navbar" id="mobileNavbar">
        <div class="mobile-nav-container">
            <a href="#dashboard" class="mobile-nav-item active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i>
                <span>Ø§Ù„ØªØ­ÙƒÙ…</span>
            </a>
            <a href="#repairs" class="mobile-nav-item" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i>
                <span>Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
            </a>
            <a href="#customers" class="mobile-nav-item" onclick="showSection('customers')">
                <i class="bi bi-people"></i>
                <span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
            </a>
            <a href="#inventory" class="mobile-nav-item" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i>
                <span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
            </a>
            <a href="#expenses" class="mobile-nav-item" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i>
                <span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
            </a>
            <a href="#reports" class="mobile-nav-item" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </a>
            <a href="#settings" class="mobile-nav-item" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
        </div>
    </nav>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="bi bi-phone"></i> Ù…Ø­Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                <i class="bi bi-speedometer2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <a href="#repairs" class="nav-link" onclick="showSection('repairs')">
                <i class="bi bi-tools"></i> Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
            </a>
            <a href="#customers" class="nav-link" onclick="showSection('customers')">
                <i class="bi bi-people"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            </a>
            <a href="#inventory" class="nav-link" onclick="showSection('inventory')">
                <i class="bi bi-box-seam"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </a>
            <a href="#expenses" class="nav-link" onclick="showSection('expenses')">
                <i class="bi bi-cash-stack"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            </a>
            <a href="#reports" class="nav-link" onclick="showSection('reports')" data-permission="manager">
                <i class="bi bi-graph-up"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            </a>
            <a href="#settings" class="nav-link" onclick="showSection('settings')" data-permission="manager">
                <i class="bi bi-gear"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <p><i class="bi bi-person-circle"></i> <strong id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong></p>
                <p><i class="bi bi-shield-check"></i> <span id="userRole">Ø§Ù„Ø¯ÙˆØ±</span></p>
            </div>
            <button onclick="logout()" class="btn btn-danger btn-sm"><i class="bi bi-box-arrow-right"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
        <header class="top-bar">
            <button class="btn-menu" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
            <h1 id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="header-actions">
                <span id="syncIndicator" class="sync-indicator" onclick="syncManager.manualSync()" title="Ø§Ø¶ØºØ· Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹"><i class="bi bi-arrow-repeat"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <button onclick="toggleDarkMode()" class="btn btn-icon" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"><i class="bi bi-moon-stars"></i></button>
            </div>
        </header>

        <div class="content">
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <section id="dashboard-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-receipt-cutoff"></i></div>
                        <div class="stat-info">
                            <h3>Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRepairs">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-currency-exchange"></i></div>
                        <div class="stat-info">
                            <h3>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <p class="stat-value" id="todayRevenue">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">ØµØ§ÙÙŠ Ø±Ø¨Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-wallet2"></i></div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©</h3>
                            <p class="stat-value" id="todayExpenses">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ù…ØµØ±ÙˆÙØ§Øª + Ù…Ø®Ø²ÙˆÙ†</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-piggy-bank"></i></div>
                        <div class="stat-info">
                            <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                            <p class="stat-value" id="todayProfit">0 Ø¬.Ù…</p>
                            <small style="font-size: 0.75em; color: #999;">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</small>
                        </div>
                    </div>
                </div>

                <div class="section-content">
                    <h2>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                    <div class="table-container">
                        <table class="data-table" id="currentRepairsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                </tr>
                            </thead>
                            <tbody id="currentRepairsBody">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
            <section id="repairs-section" class="section"></section>

            <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
            <section id="customers-section" class="section"></section>

            <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
            <section id="inventory-section" class="section"></section>

            <!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
            <section id="expenses-section" class="section"></section>

            <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <section id="reports-section" class="section"></section>

            <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <section id="settings-section" class="section"></section>
        </div>
    </main>

    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data-protection.js"></script>
    <script src="js/security.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/encryption.js"></script>
    <script src="js/encryption-settings.js"></script>
    <script src="js/barcode.js"></script>
    <script src="js/small-label.js"></script>
    <script src="js/image-management.js"></script>
    <script src="js/test-connection.js"></script>
    <script src="js/backup-management.js"></script>
    <script src="js/repairs.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/settings.js"></script>
    
    <script>
        let currentSection = 'dashboard';

        // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© - Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        (async function() {
            const user = await checkLogin();
            if (!user) {
                localStorage.clear();
                sessionStorage.clear();
                showLoginRequiredMessage();
                return;
            }
        })();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', async () => {
            const user = await checkLogin();
            if (!user) {
                localStorage.clear();
                sessionStorage.clear();
                showLoginRequiredMessage();
                return;
            }
            
            displayUserInfo();
            hideByPermission();
            loadDarkMode();
            setupModalCloseOnClickOutside();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            await loadDashboardData();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            await initializeAutoBackup();
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            loadRepairsSection();
            loadCustomersSection();
            loadInventorySection();
            loadExpensesSection();
            loadReportsSection();
            loadSettingsSection();
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡
            setTimeout(() => {
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                    syncManager.startAutoSync();
                }
            }, 3000);
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        window.addEventListener('beforeunload', (event) => {
            // Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
                syncManager.stopAutoSync();
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            if (typeof window.currentCameraStream !== 'undefined' && window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
                window.currentCameraStream = null;
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹
            if (typeof Quagga !== 'undefined') {
                try {
                    Quagga.stop();
                    Quagga.offDetected();
                } catch (e) {
                    console.log('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
            }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (typeof allRepairs !== 'undefined') allRepairs = [];
            if (typeof allCustomers !== 'undefined') allCustomers = [];
            if (typeof allInventory !== 'undefined') allInventory = [];
            if (typeof allExpenses !== 'undefined') allExpenses = [];
            
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            window.removeEventListener('online', () => {});
            window.removeEventListener('offline', () => {});
            window.removeEventListener('resize', () => {});
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø¥Ù„Ù‰ Service Worker
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CLEANUP'
                });
            }
            
            console.log('[Dashboard] ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø®ÙÙŠ');
                    syncManager.stopAutoSync();
                }
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
                if (typeof syncManager !== 'undefined' && !syncManager.isInitialized) {
                    console.log('[Dashboard] Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ø±Ø¦ÙŠ');
                    syncManager.startAutoSync();
                }
            }
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            sidebar.classList.toggle('show');
        }

        // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function showSection(section) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(`${section}-section`).classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·
            event.target.closest('.nav-link').classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            const titles = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'repairs': 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
                'customers': 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                'inventory': 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
                'expenses': 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
                'reports': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
            };
            document.getElementById('pageTitle').textContent = titles[section];
            currentSection = section;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            updateSectionData(section);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù…
            updateMobileNavbar(section);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ sidebar ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØªØ¨ÙˆÙŠØ¨
            if (window.innerWidth <= 575.98) {
                const sidebar = document.getElementById('sidebar');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        async function updateSectionData(section) {
            try {
                switch (section) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'repairs':
                        if (typeof loadRepairsSection === 'function') {
                            loadRepairsSection();
                        }
                        break;
                    case 'customers':
                        if (typeof loadCustomersSection === 'function') {
                            loadCustomersSection();
                        }
                        break;
                    case 'inventory':
                        if (typeof loadInventorySection === 'function') {
                            loadInventorySection();
                        }
                        break;
                    case 'expenses':
                        if (typeof loadExpensesSection === 'function') {
                            loadExpensesSection();
                        }
                        break;
                    case 'reports':
                        if (typeof loadReportsSection === 'function') {
                            loadReportsSection();
                        }
                        break;
                    case 'settings':
                        if (typeof loadSettingsSection === 'function') {
                            loadSettingsSection();
                        }
                        break;
                }
            } catch (error) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ${section}:`, error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        async function loadDashboardData() {
            const today = getTodayDate();
            const result = await API.getReport('daily', today);
            
            if (result.success) {
                const data = result.data;
                document.getElementById('todayRepairs').textContent = data.repairs_count;
                document.getElementById('todayRevenue').textContent = formatCurrency(data.revenue);
                document.getElementById('todayExpenses').textContent = formatCurrency(data.expenses);
                document.getElementById('todayProfit').textContent = formatCurrency(data.profit);
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const repairsResult = await API.getRepairs();
            if (repairsResult.success) {
                const currentRepairs = repairsResult.data.filter(r => 
                    r.status === 'pending' || r.status === 'in_progress' || r.status === 'ready'
                );
                displayCurrentRepairs(currentRepairs);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function displayCurrentRepairs(repairs) {
            const tbody = document.getElementById('currentRepairsBody');
            
            if (repairs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©</td></tr>';
                return;
            }
            
            tbody.innerHTML = repairs.slice(0, 10).map(repair => `
                <tr>
                    <td>${repair.repair_number}</td>
                    <td>${repair.customer_name}</td>
                    <td>${repair.device_type} ${repair.device_model || ''}</td>
                    <td><span class="status-badge" style="background: ${getStatusColor(repair.status)}">${getStatusText(repair.status)}</span></td>
                    <td>${formatDate(repair.created_at)}</td>
                </tr>
            `).join('');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            } else {
                sidebar.classList.add('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-x"></i>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ navbar Ø§Ù„Ø¹Ø§Ø¦Ù… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function updateMobileNavbar(activeSection) {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + activeSection) {
                    item.classList.add('active');
                }
            });
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (window.innerWidth <= 575.98) {
                if (!sidebar.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                    sidebar.classList.remove('open');
                    mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
                }
            }
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (window.innerWidth > 575.98) {
                sidebar.classList.remove('open');
                mobileMenuBtn.innerHTML = '<i class="bi bi-list"></i>';
            }
        });

        // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± - Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆÙØªØ­ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„
        (function() {
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù†
            document.addEventListener('contextmenu', function(e) {
                e.stopPropagation();
            }, true);
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', function(e) {
                // F12 - ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
                if (e.key === 'F12') {
                    e.preventDefault();
                    console.log('ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ F12 - Ø§ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©');
                }
                
                // Ctrl+Shift+I Ø£Ùˆ Ctrl+Shift+J
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'i' || e.key === 'j')) {
                    e.preventDefault();
                    console.log('Ø§Ø³ØªØ®Ø¯Ù… F12 Ø£Ùˆ Ø§Ø¶ØºØ· Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆØ§Ø®ØªØ± "ÙØ­Øµ Ø§Ù„Ø¹Ù†ØµØ±"');
                }
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„ÙØªØ­ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹
            const devButton = document.createElement('button');
            devButton.innerHTML = 'ğŸ”§ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±';
            devButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                z-index: 99999;
                padding: 10px 15px;
                background: #2196F3;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            devButton.onclick = function() {
                alert('Ù„ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±:\n\n1. Ø§Ø¶ØºØ· F12\n2. Ø£Ùˆ Ø§Ø¶ØºØ· Ctrl+Shift+I (Windows/Linux)\n3. Ø£Ùˆ Cmd+Option+I (Mac)\n4. Ø£Ùˆ Ø§Ø¶ØºØ· Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆØ§Ø®ØªØ± "ÙØ­Øµ Ø§Ù„Ø¹Ù†ØµØ±"');
            };
            document.body.appendChild(devButton);
            
            console.log('%cğŸ”§ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± Ù…ÙØ¹Ù‘Ù„', 'color: #2196F3; font-size: 16px; font-weight: bold;');
            console.log('%cÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡', 'color: #4CAF50; font-size: 12px;');
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            console.log('%cğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:', 'color: #2196F3; font-size: 14px; font-weight: bold;');
            console.log('API Base URL:', API_BASE_URL);
        })();

    </script>
</body>
</html>

